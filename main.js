function ca(g){var k=0;return function(){return k<g.length?{done:!1,value:g[k++]}:{done:!0}}}function ja(g){var k="undefined"!=typeof Symbol&&Symbol.iterator&&g[Symbol.iterator];return k?k.call(g):{next:ca(g)}}var ma="function"==typeof Object.create?Object.create:function(g){function k(){}k.prototype=g;return new k},ua="function"==typeof Object.defineProperties?Object.defineProperty:function(g,k,l){if(g==Array.prototype||g==Object.prototype)return g;g[k]=l.value;return g};
function va(g){g=["object"==typeof globalThis&&globalThis,g,"object"==typeof window&&window,"object"==typeof self&&self,"object"==typeof global&&global];for(var k=0;k<g.length;++k){var l=g[k];if(l&&l.Math==Math)return l}throw Error("Cannot find global object");}var wa=va(this);function O(g,k){if(k)a:{var l=wa;g=g.split(".");for(var t=0;t<g.length-1;t++){var w=g[t];if(!(w in l))break a;l=l[w]}g=g[g.length-1];t=l[g];k=k(t);k!=t&&null!=k&&ua(l,g,{configurable:!0,writable:!0,value:k})}}var za;
if("function"==typeof Object.setPrototypeOf)za=Object.setPrototypeOf;else{var Aa;a:{var Ba={a:!0},Ca={};try{Ca.__proto__=Ba;Aa=Ca.a;break a}catch(g){}Aa=!1}za=Aa?function(g,k){g.__proto__=k;if(g.__proto__!==k)throw new TypeError(g+" is not extensible");return g}:null}var Da=za;
function Ea(g,k){g.prototype=ma(k.prototype);g.prototype.constructor=g;if(Da)Da(g,k);else for(var l in k)if("prototype"!=l)if(Object.defineProperties){var t=Object.getOwnPropertyDescriptor(k,l);t&&Object.defineProperty(g,l,t)}else g[l]=k[l];g.Nb=k.prototype}
O("Symbol",function(g){function k(A){if(this instanceof k)throw new TypeError("Symbol is not a constructor");return new l(t+(A||"")+"_"+w++,A)}function l(A,D){this.h=A;ua(this,"description",{configurable:!0,writable:!0,value:D})}if(g)return g;l.prototype.toString=function(){return this.h};var t="jscomp_symbol_"+(1E9*Math.random()>>>0)+"_",w=0;return k});
O("Symbol.iterator",function(g){if(g)return g;g=Symbol("Symbol.iterator");for(var k="Array Int8Array Uint8Array Uint8ClampedArray Int16Array Uint16Array Int32Array Uint32Array Float32Array Float64Array".split(" "),l=0;l<k.length;l++){var t=wa[k[l]];"function"===typeof t&&"function"!=typeof t.prototype[g]&&ua(t.prototype,g,{configurable:!0,writable:!0,value:function(){return Ga(ca(this))}})}return g});function Ga(g){g={next:g};g[Symbol.iterator]=function(){return this};return g}
function Ha(g,k){g instanceof String&&(g+="");var l=0,t=!1,w={next:function(){if(!t&&l<g.length){var A=l++;return{value:k(A,g[A]),done:!1}}t=!0;return{done:!0,value:void 0}}};w[Symbol.iterator]=function(){return w};return w}O("Array.prototype.keys",function(g){return g?g:function(){return Ha(this,function(k){return k})}});O("Object.is",function(g){return g?g:function(k,l){return k===l?0!==k||1/k===1/l:k!==k&&l!==l}});
O("Array.prototype.includes",function(g){return g?g:function(k,l){var t=this;t instanceof String&&(t=String(t));var w=t.length;l=l||0;for(0>l&&(l=Math.max(l+w,0));l<w;l++){var A=t[l];if(A===k||Object.is(A,k))return!0}return!1}});
O("String.prototype.includes",function(g){return g?g:function(k,l){if(null==this)throw new TypeError("The 'this' value for String.prototype.includes must not be null or undefined");if(k instanceof RegExp)throw new TypeError("First argument to String.prototype.includes must not be a regular expression");return-1!==this.indexOf(k,l||0)}});O("Array.prototype.values",function(g){return g?g:function(){return Ha(this,function(k,l){return l})}});
function Ia(g,k){return Object.prototype.hasOwnProperty.call(g,k)}
O("WeakMap",function(g){function k(m){this.h=(p+=Math.random()+1).toString();if(m){m=ja(m);for(var q;!(q=m.next()).done;)q=q.value,this.set(q[0],q[1])}}function l(){}function t(m){var q=typeof m;return"object"===q&&null!==m||"function"===q}function w(m){if(!Ia(m,D)){var q=new l;ua(m,D,{value:q})}}function A(m){var q=Object[m];q&&(Object[m]=function(x){if(x instanceof l)return x;Object.isExtensible(x)&&w(x);return q(x)})}if(function(){if(!g||!Object.seal)return!1;try{var m=Object.seal({}),q=Object.seal({}),
x=new g([[m,2],[q,3]]);if(2!=x.get(m)||3!=x.get(q))return!1;x.delete(m);x.set(q,4);return!x.has(m)&&4==x.get(q)}catch(M){return!1}}())return g;var D="$jscomp_hidden_"+Math.random();A("freeze");A("preventExtensions");A("seal");var p=0;k.prototype.set=function(m,q){if(!t(m))throw Error("Invalid WeakMap key");w(m);if(!Ia(m,D))throw Error("WeakMap key fail: "+m);m[D][this.h]=q;return this};k.prototype.get=function(m){return t(m)&&Ia(m,D)?m[D][this.h]:void 0};k.prototype.has=function(m){return t(m)&&Ia(m,
D)&&Ia(m[D],this.h)};k.prototype.delete=function(m){return t(m)&&Ia(m,D)&&Ia(m[D],this.h)?delete m[D][this.h]:!1};return k});
O("Map",function(g){function k(){var p={};return p.ga=p.next=p.head=p}function l(p,m){var q=p.h;return Ga(function(){if(q){for(;q.head!=p.h;)q=q.ga;for(;q.next!=q.head;)return q=q.next,{done:!1,value:m(q)};q=null}return{done:!0,value:void 0}})}function t(p,m){var q=m&&typeof m;"object"==q||"function"==q?A.has(m)?q=A.get(m):(q=""+ ++D,A.set(m,q)):q="p_"+m;var x=p.j[q];if(x&&Ia(p.j,q))for(p=0;p<x.length;p++){var M=x[p];if(m!==m&&M.key!==M.key||m===M.key)return{id:q,list:x,index:p,K:M}}return{id:q,list:x,
index:-1,K:void 0}}function w(p){this.j={};this.h=k();this.size=0;if(p){p=ja(p);for(var m;!(m=p.next()).done;)m=m.value,this.set(m[0],m[1])}}if(function(){if(!g||"function"!=typeof g||!g.prototype.entries||"function"!=typeof Object.seal)return!1;try{var p=Object.seal({x:4}),m=new g(ja([[p,"s"]]));if("s"!=m.get(p)||1!=m.size||m.get({x:4})||m.set({x:4},"t")!=m||2!=m.size)return!1;var q=m.entries(),x=q.next();if(x.done||x.value[0]!=p||"s"!=x.value[1])return!1;x=q.next();return x.done||4!=x.value[0].x||
"t"!=x.value[1]||!q.next().done?!1:!0}catch(M){return!1}}())return g;var A=new WeakMap;w.prototype.set=function(p,m){p=0===p?0:p;var q=t(this,p);q.list||(q.list=this.j[q.id]=[]);q.K?q.K.value=m:(q.K={next:this.h,ga:this.h.ga,head:this.h,key:p,value:m},q.list.push(q.K),this.h.ga.next=q.K,this.h.ga=q.K,this.size++);return this};w.prototype.delete=function(p){p=t(this,p);return p.K&&p.list?(p.list.splice(p.index,1),p.list.length||delete this.j[p.id],p.K.ga.next=p.K.next,p.K.next.ga=p.K.ga,p.K.head=null,
this.size--,!0):!1};w.prototype.clear=function(){this.j={};this.h=this.h.ga=k();this.size=0};w.prototype.has=function(p){return!!t(this,p).K};w.prototype.get=function(p){return(p=t(this,p).K)&&p.value};w.prototype.entries=function(){return l(this,function(p){return[p.key,p.value]})};w.prototype.keys=function(){return l(this,function(p){return p.key})};w.prototype.values=function(){return l(this,function(p){return p.value})};w.prototype.forEach=function(p,m){for(var q=this.entries(),x;!(x=q.next()).done;)x=
x.value,p.call(m,x[1],x[0],this)};w.prototype[Symbol.iterator]=w.prototype.entries;var D=0;return w});
O("Set",function(g){function k(l){this.h=new Map;if(l){l=ja(l);for(var t;!(t=l.next()).done;)this.add(t.value)}this.size=this.h.size}if(function(){if(!g||"function"!=typeof g||!g.prototype.entries||"function"!=typeof Object.seal)return!1;try{var l=Object.seal({x:4}),t=new g(ja([l]));if(!t.has(l)||1!=t.size||t.add(l)!=t||1!=t.size||t.add({x:4})!=t||2!=t.size)return!1;var w=t.entries(),A=w.next();if(A.done||A.value[0]!=l||A.value[1]!=l)return!1;A=w.next();return A.done||A.value[0]==l||4!=A.value[0].x||
A.value[1]!=A.value[0]?!1:w.next().done}catch(D){return!1}}())return g;k.prototype.add=function(l){l=0===l?0:l;this.h.set(l,l);this.size=this.h.size;return this};k.prototype.delete=function(l){l=this.h.delete(l);this.size=this.h.size;return l};k.prototype.clear=function(){this.h.clear();this.size=0};k.prototype.has=function(l){return this.h.has(l)};k.prototype.entries=function(){return this.h.entries()};k.prototype.values=function(){return this.h.values()};k.prototype.keys=k.prototype.values;k.prototype[Symbol.iterator]=
k.prototype.values;k.prototype.forEach=function(l,t){var w=this;this.h.forEach(function(A){return l.call(t,A,A,w)})};return k});
(function(g){function k(a,c){this.o=!1;this.update=a;this.oa=c;this.h=16.666666666666668}function l(){this.touches=[]}function t(){this.ea=this.da=this.y=this.x=0;this.gb=this.Ka=this.hb=this.wb=!1;this.xb=0}function w(){this.C=this.s=this.ea=this.da=this.y=this.x=0;this.h=this.j=this.L=this.J=this.o=this.left=!1}function A(){this.keys=new E;this.o=new Set;this.j=new Set;this.h=new Set;this.s=new Set}function D(){}function p(a,c,b,d,h){this.j=new w;this.touches=new l;this.h=d?new A:null;this.sa=1;
this.o(a,b,c,h)}function m(){}function q(a,c,b){this.g=a;this.name=c;this.size=b;this.i=new Float32Array(64);this.length=0;this.buffer=a.createBuffer()}function x(a){this.g=a;this.aa=null;this.o=this.j=33071;this.h=9729;this.aa=a.createTexture();this.J=a.createFramebuffer();this.F=a.createRenderbuffer()}function M(){}function C(a){this.g=a;this.l=a.createProgram();this.j=a.createShader(35633);this.h=a.createShader(35632);this.o=this.s=this.map=null;this.u=!1;this.ba=new E}function Fa(a){this.g=a;
this.i=new Int32Array(512);this.length=0;this.buffer=a.createBuffer()}function J(){var a=[];a.push(0);a.push(0);a.push(0);a.push(0);a.push(0);a.push(0);a.push(0);a.push(0);a.push(0);a.push(0);a.push(0);a.push(0);a.push(0);a.push(0);a.push(0);a.push(0);this.i=a;a=[];a.push(0);a.push(0);a.push(0);a.push(0);a.push(0);a.push(0);a.push(0);a.push(0);a.push(0);this.Y=a}function P(){}function K(a){this.canvas=a;this.g=xa.h(a);this.Qa();this.Sa();this.Pa();this.Ra();this.ya=.1;this.xa=1E4;this.ua=Math.PI/
3;this.za=!1;this.ma=a.width;this.L=a.height;if(null==this.N){if(null==this.N){a=this.canvas.width;var c=this.canvas.height}else a=this.N.width,c=this.N.height;this.g.viewport(0,0,a,c)}this.ua=a=Math.PI/3;this.ya=.1;this.xa=1E4;this.la.perspective(a,this.ma/this.L,.1,1E4);this.Da=0;this.P=this.R=this.S=this.T=1;this.$=this.Z=this.Ja=this.Ia=this.Ha=0;this.N=this.A=null;this.G=1;this.W=!1;this.j=Array(8);this.j[0]=new P;this.j[1]=new P;this.j[2]=new P;this.j[3]=new P;this.j[4]=new P;this.j[5]=new P;
this.j[6]=new P;this.j[7]=new P;this.J=0}function da(a,c){this.h=a;this.canvas=c;this.o();this.j=new k(na(this,this.update),na(this,this.oa))}function xa(){}function ea(){}function E(){this.m=Object.create(null)}function oa(a,c,b){c=H.call(this,String(a),c,b)||this;c.value=a;return c}function H(a,c,b){c=Error.call(this,a);this.message=c.message;"stack"in c&&(this.stack=c.stack);this.message=a;this.h=null!=b?b:this}function u(){}function ya(){}function y(a,c,b,d){return ia.call(this,a,c,b,d)||this}
function ia(a,c,b,d){null==d&&(d=!0);null==b&&(b=!0);null==c&&(c=ka.jb);this.canvas=a;this.C=new da(this,a);switch(c.na){case 0:this.input=new p(a,this.C,a,b,d);break;case 1:this.input=new p(a,this.C,window.document.documentElement,b,d);break;case 2:this.input=null}this.cb=-1;this.ma();this.C.C()}function N(a,c,b,d){this.v=a;var h=b?36193:5121;null==h&&(h=5121);var e=new x(a.g);e.C(c,c,h);this.src=e;b=b?36193:5121;null==b&&(b=5121);a=new x(a.g);a.C(c,c,b);this.qa=a;c=this.src;if(c.s)throw H.j("cannot use texture wrapping in NPOT textures");
c.j=10497;c.o=10497;c.g.bindTexture(3553,c.aa);c.g.texParameteri(3553,10242,10497);c.g.texParameteri(3553,10243,10497);c.g.bindTexture(3553,null);c=this.qa;if(c.s)throw H.j("cannot use texture wrapping in NPOT textures");c.j=10497;c.o=10497;c.g.bindTexture(3553,c.aa);c.g.texParameteri(3553,10242,10497);c.g.texParameteri(3553,10243,10497);c.g.bindTexture(3553,null);c=this.src;a=d?9729:9728;c.h=a;c.g.bindTexture(3553,c.aa);switch(a){case 9728:c.g.texParameteri(3553,10240,9728);c.g.texParameteri(3553,
10241,9728);break;case 9729:c.g.texParameteri(3553,10240,9729),c.g.texParameteri(3553,10241,9729)}c.g.bindTexture(3553,null);c=this.qa;d=d?9729:9728;c.h=d;c.g.bindTexture(3553,c.aa);switch(d){case 9728:c.g.texParameteri(3553,10240,9728);c.g.texParameteri(3553,10241,9728);break;case 9729:c.g.texParameteri(3553,10240,9729),c.g.texParameteri(3553,10241,9729)}c.g.bindTexture(3553,null);this.D(function(f){if(1!=f.W)throw Error("begin scene before clear scene");f.g.clearColor(0,0,0,0);f.g.clearDepth(1);
f.g.clear(16640)})}function la(){return ea.h(this,"")}function na(a,c){if(null==c)return null;null==c.Ua&&(c.Ua=g.ib++);var b;null==a.eb?a.eb={}:b=a.eb[c.Ua];null==b&&(b=c.bind(a),a.eb[c.Ua]=b);return b}var pa=pa||{},qa;N.prototype.D=function(a){var c=this.v,b=this.qa;c.N=b;null==b?(c.g.bindFramebuffer(36160,null),c.g.viewport(0,0,c.canvas.width,c.canvas.height)):(c.g.bindFramebuffer(36160,b.J),c.g.viewport(0,0,b.width,b.height));this.v.nb();a(this.v);a=this.v;if(1!=a.W)throw Error("scene already ended");
a.W=!1;a.g.flush();a=this.v;a.N=null;a.g.bindFramebuffer(36160,null);a.g.viewport(0,0,a.canvas.width,a.canvas.height);a=this.src;this.src=this.qa;this.qa=a};N.B=!0;ia.prototype.ma=function(){};ia.prototype.update=function(){};ia.prototype.oa=function(){};ia.B=!0;Ea(y,ia);y.prototype.ma=function(){this.C.frameRate(ra.kb(60));this.v=new K(this.canvas);this.v.Oa();var a=this.v;a.ma=1;a.L=1;if(null==a.N){if(null==a.N){var c=a.canvas.width;var b=a.canvas.height}else c=a.N.width,b=a.N.height;a.g.viewport(0,
0,c,b)}c=Math.PI/3;a.ua=c;a.ya=.1;a.xa=1E4;a.la.perspective(c,a.ma/a.L,.1,1E4);this.ua();this.C.start()};y.prototype.Va=function(){this.j=new N(this.v,y.h,!0,!0);this.J=new N(this.v,y.h,!0,!0);this.j.D(function(a){a.T=1;a.S=0;a.R=0;a.P=1;a.rect(0,0,1,1);a.T=0;a.S=1;a.R=0;for(a.P=1;;)break;a.rect(0,.6,1,.4)})};y.prototype.La=function(){this.F=new N(this.v,y.h,!0,!0);this.ca=new N(this.v,y.h,!0,!0);this.F.D(function(a){if(1!=a.W)throw Error("begin scene before clear scene");a.g.clearColor(0,0,0,1);
a.g.clearDepth(1);a.g.clear(16640);a.Xa(4);a.T=-1;a.S=1;a.R=0;a.P=1;a.M(0,0);a.T=1;a.S=-1;a.R=0;a.P=1;a.M(1,0);a.T=-1;a.S=-1;a.R=0;a.P=1;a.M(1,1);a.T=-1;a.S=1;a.R=0;a.P=1;a.M(0,0);a.T=-1;a.S=-1;a.R=0;a.P=1;a.M(1,1);a.T=1;a.S=-1;a.R=0;a.P=1;a.M(0,1);a.ab();a.T=0;a.S=0;a.R=0;a.P=1;a.rect(0,0,1,1)})};y.prototype.Ta=function(){this.la=new N(this.v,y.h,!1,!1);this.la.D(function(a){if(1!=a.W)throw Error("begin scene before clear scene");a.g.clearColor(1,0,0,1);a.g.clearDepth(1);a.g.clear(16640);a.T=0;a.S=
0;a.R=0;a.P=1;a.rect(0,0,1,1/y.h)})};y.prototype.Sa=function(){this.ja=new N(this.v,y.h,!0,!1);this.weight=new N(this.v,y.h,!0,!1);this.ka=new N(this.v,y.h,!0,!1);this.s=new N(this.v,y.h,!0,!1)};y.prototype.Qa=function(){this.U=new N(this.v,y.h,!0,!1)};y.prototype.ua=function(){this.La();this.Sa();this.Qa();this.Ta();this.Va();this.v.g.blendFunc(1,0);var a=new C(this.v.g);a.s="\r\n\t\t\tattribute vec4 position;\r\n\t\t\tattribute vec2 texCoord;\r\n\t\t\tuniform mat4 transform;\r\n\t\t\tuniform float invTexSize;\r\n\t\t\t\r\n\t\t\tvarying vec2 uv;\r\n\t\t\tvarying vec2 uvL;\r\n\t\t\tvarying vec2 uvR;\r\n\t\t\tvarying vec2 uvT;\r\n\t\t\tvarying vec2 uvB;\r\n\r\n\t\t\tvoid main() {\r\n\t\t\t\tgl_Position = transform * position;\r\n\t\t\t\tuv = texCoord;\r\n\t\t\t\tuvL = uv + vec2(-1, 0) * invTexSize;\r\n\t\t\t\tuvR = uv + vec2( 1, 0) * invTexSize;\r\n\t\t\t\tuvT = uv + vec2(0, -1) * invTexSize;\r\n\t\t\t\tuvB = uv + vec2(0,  1) * invTexSize;\r\n\t\t\t}\r\n\t\t";
a.u=!1;a.o="\r\n\t\t\tprecision highp float;\r\n\t\t\tuniform float texSize;\r\n\t\t\tuniform float invTexSize;\r\n\t\t\tuniform ivec2 resolution;\r\n\t\t\tvarying vec2 uv;\r\n\t\t\tvarying vec2 uvL;\r\n\t\t\tvarying vec2 uvR;\r\n\t\t\tvarying vec2 uvT;\r\n\t\t\tvarying vec2 uvB; \r\n\t\t\r\n\t\t\tuniform sampler2D vof;\r\n\t\t\tuniform sampler2D vel;\r\n\t\t\tuniform sampler2D lim;\r\n\t\t\tuniform sampler2D room;\r\n\t\t\tuniform sampler2D pweight;\r\n\t\t\t\r\n\t\t\tvec2 v(vec2 uv) {\r\n\t\t\t\tfloat vx = texture2D(vel, uv + vec2(0.5, 0) * invTexSize).x;\r\n\t\t\t\tfloat vy = texture2D(vel, uv + vec2(0, 0.5) * invTexSize).y;\r\n\t\t\t\treturn vec2(vx, vy);\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tvec2 ratio(vec2 uv) {\r\n\t\t\t\tvec2 vof = texture2D(vof, uv).xy;\r\n\t\t\t\tfloat inv = 1.0 / (vof.x + vof.y + 1e-4);\r\n\t\t\t\treturn vof * inv;\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tvec4 grad(vec2 uv) {\r\n\t\t\t\tvec4 w = texture2D(pweight, uv);\r\n\t\t\t\tvec2 rc = ratio(uv);\r\n\t\t\t\tvec2 rL = ratio(uv - vec2(invTexSize, 0));\r\n\t\t\t\tvec2 rT = ratio(uv - vec2(0, invTexSize));\r\n\t\t\t\tvec2 rR = ratio(uv + vec2(invTexSize, 0));\r\n\t\t\t\tvec2 rB = ratio(uv + vec2(0, invTexSize));\r\n\t\t\t\tvec2 gx = (rc - rL) * w.x + (rR - rc) * w.z;\r\n\t\t\t\tvec2 gy = (rc - rT) * w.y + (rB - rc) * w.w;\r\n\t\t\t\treturn vec4(gx, gy);\r\n\t\t\t}\r\n\r\n\t\t\tvoid main() {\r\n\t\t\t\tfloat room = texture2D(room, uv).x;\r\n\t\t\t\tif (room < 0.01) {\r\n\t\t\t\t\tgl_FragColor = vec4(0);\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\tvec2 res = vec2(0);\r\n\t\t\t\tfor (int dx = -2; dx <= 2; dx++) {\r\n\t\t\t\t\tfor (int dy = -2; dy <= 2; dy++) {\r\n\t\t\t\t\t\tvec2 duv = invTexSize * vec2(dx, dy);\r\n\t\t\t\t\t\tvec2 pos = uv + duv;\r\n\t\t\t\t\t\tvec2 vof = texture2D(vof, pos).xy;\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tvec2 vel = v(pos);\r\n\t\t\t\t\t\tvec4 lim = texture2D(lim, pos);\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tfloat gradPower = 1.0 - max(0.0, abs(pos.y - 0.5) - 0.2) / 0.3;\r\n\t\t\t\t\t\t\r\n\t\t\t\t\t\tvec4 grad = grad(pos);\r\n\t\t\t\t\t\tvec2 grad1 = grad.xz;\r\n\t\t\t\t\t\tvec2 grad2 = grad.yw;\r\n\t\t\t\t\t\tvec2 vel1 = vel + grad1 * 0.6 * gradPower;\r\n\t\t\t\t\t\tvec2 vel2 = vel + grad2 * 0.6 * gradPower;\r\n\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\tvel1 = max(lim.xy, min(lim.zw, vel1));\r\n\t\t\t\t\t\t\tvec2 posNext = pos + vel1 * invTexSize;\r\n\t\t\t\t\t\t\tvec2 diff = max(vec2(0), 1.0 - abs(uv - posNext) * texSize);\r\n\t\t\t\t\t\t\tfloat weight = diff.x * diff.y;\r\n\t\t\t\t\t\t\tres.x += weight * vof.x;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\tvel2 = max(lim.xy, min(lim.zw, vel2));\r\n\t\t\t\t\t\t\tvec2 posNext = pos + vel2 * invTexSize;\r\n\t\t\t\t\t\t\tvec2 diff = max(vec2(0), 1.0 - abs(uv - posNext) * texSize);\r\n\t\t\t\t\t\t\tfloat weight = diff.x * diff.y;\r\n\t\t\t\t\t\t\tres.y += weight * vof.y;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\tfloat len = res.x + res.y;\r\n\t\t\t\tfloat ratio = res.x / (len + 1e-4);\r\n\t\t\t\tif (uv.y > 0.7) ratio += (1.0 - ratio) * (uv.y - 0.7) * 0.5;\r\n\t\t\t\tif (uv.y < 0.2) ratio += (0.0 - ratio) * (0.2 - uv.y) * 2.0;\r\n\t\t\t\tres = vec2(ratio, 1.0 - ratio) * len;\r\n\t\t\t\tres = max(vec2(0), res);\r\n\t\t\t\tgl_FragColor = vec4(res, 0, 0);\r\n\t\t\t}\r\n\t\t";
a.u=!1;a.map=new E;a.g.shaderSource(a.j,a.s);a.g.compileShader(a.j);a.g.getShaderParameter(a.j,35713)||window.alert(u.h(a.g.getShaderInfoLog(a.j)+"\nsource:\n"+a.s));a.g.shaderSource(a.h,a.o);a.g.compileShader(a.h);a.g.getShaderParameter(a.h,35713)||window.alert(u.h(a.g.getShaderInfoLog(a.h)+"\nsource:\n"+a.o));a.g.attachShader(a.l,a.j);a.g.attachShader(a.l,a.h);a.g.linkProgram(a.l);a.g.getProgramParameter(a.l,35714)?a.u=!0:g.console.log("link failed: "+a.g.getProgramInfoLog(a.l));this.va=a;a=new C(this.v.g);
a.s="\r\n\t\t\tattribute vec4 position;\r\n\t\t\tattribute vec2 texCoord;\r\n\t\t\tuniform mat4 transform;\r\n\t\t\tuniform float invTexSize;\r\n\t\t\t\r\n\t\t\tvarying vec2 uv;\r\n\t\t\tvarying vec2 uvL;\r\n\t\t\tvarying vec2 uvR;\r\n\t\t\tvarying vec2 uvT;\r\n\t\t\tvarying vec2 uvB;\r\n\r\n\t\t\tvoid main() {\r\n\t\t\t\tgl_Position = transform * position;\r\n\t\t\t\tuv = texCoord;\r\n\t\t\t\tuvL = uv + vec2(-1, 0) * invTexSize;\r\n\t\t\t\tuvR = uv + vec2( 1, 0) * invTexSize;\r\n\t\t\t\tuvT = uv + vec2(0, -1) * invTexSize;\r\n\t\t\t\tuvB = uv + vec2(0,  1) * invTexSize;\r\n\t\t\t}\r\n\t\t";
a.u=!1;a.o="\r\n\t\t\tprecision highp float;\r\n\t\t\tuniform float texSize;\r\n\t\t\tuniform float invTexSize;\r\n\t\t\tuniform ivec2 resolution;\r\n\t\t\tvarying vec2 uv;\r\n\t\t\tvarying vec2 uvL;\r\n\t\t\tvarying vec2 uvR;\r\n\t\t\tvarying vec2 uvT;\r\n\t\t\tvarying vec2 uvB; \r\n\t\t\r\n\t\t\tuniform sampler2D vof;\r\n\t\t\tuniform sampler2D vel;\r\n\t\t\tuniform sampler2D lim;\r\n\t\t\tuniform sampler2D target;\r\n\t\t\t\r\n\t\t\tuniform float gScale;\r\n\t\t\t\r\n\t\t\tvec4 v(vec2 uv) {\r\n\t\t\t\tvec2 v = texture2D(vel, uv).xy;\r\n\t\t\t\tfloat xvy = texture2D(vel, uv + vec2(-0.5, 0.5) * invTexSize).y;\r\n\t\t\t\tfloat yvx = texture2D(vel, uv + vec2(0.5, -0.5) * invTexSize).x;\r\n\t\t\t\treturn vec4(v.x, xvy, yvx, v.y);\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tfloat curl(vec2 uv) {\r\n\t\t\t\tvec2 rb = texture2D(vel, uv).xy;\r\n\t\t\t\tfloat l = texture2D(vel, uv - vec2(1, 0) * invTexSize).y;\r\n\t\t\t\tfloat t = texture2D(vel, uv - vec2(0, 1) * invTexSize).x;\r\n\t\t\t\treturn l - rb.y + rb.x - t;\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tvec2 dir(vec2 uv) {\r\n\t\t\t\tfloat dx = abs(curl(uv - vec2(0, 1) * invTexSize)) - abs(curl(uv + vec2(0, 1) * invTexSize));\r\n\t\t\t\tfloat dy = abs(curl(uv + vec2(1, 0) * invTexSize)) - abs(curl(uv - vec2(1, 0) * invTexSize));\r\n\t\t\t\tvec2 d = vec2(dx, dy);\r\n\t\t\t\treturn d / (length(d) + 1e-4);\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tvec2 vc() {\r\n\t\t\t\tvec2 dc = dir(uv);\r\n\t\t\t\tvec2 db = dir(uvB);\r\n\t\t\t\tvec2 dr = dir(uvR);\r\n\t\t\t\tfloat dx = (dc + db).x * 0.5;\r\n\t\t\t\tfloat dy = (dc + dr).y * 0.5;\r\n\t\t\t\tfloat cc = curl(uv);\r\n\t\t\t\tfloat cb = curl(uvB);\r\n\t\t\t\tfloat cr = curl(uvR);\r\n\t\t\t\tfloat cx = (cc + cb) * 0.5;\r\n\t\t\t\tfloat cy = (cc + cr) * 0.5;\r\n\t\t\t\treturn vec2(dx * cx, dy * cy);\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tvoid main() {\r\n\t\t\t\tvec4 v = v(uv) * invTexSize;\r\n\t\t\t\tvec2 vel = vec2(texture2D(vel, uv - v.xy).x, texture2D(vel, uv - v.zw).y);\r\n\t\t\t\t\r\n\t\t\t\tvel *= 0.992;\r\n\t\t\t\t\r\n\t\t\t\tvec2 vo = texture2D(vof, uv).xy;\r\n\t\t\t\tvec2 tg = texture2D(target, uv).zw;\r\n\t\t\t\tvel.y += dot(vo * tg, vec2(-1, 1)) * 0.03 * gScale;\r\n\t\t\t\t\r\n\t\t\t\tvel += vc() * 0.2;\r\n\t\t\t\t\r\n\t\t\t\tvec4 lim = texture2D(lim, uv);\r\n\t\t\t\tvel = max(lim.xy, min(lim.zw, vel));\r\n\t\t\t\t\r\n\t\t\t\tgl_FragColor = vec4(vel, 0, 0);\r\n\t\t\t}\r\n\t\t";
a.u=!1;a.map=new E;a.g.shaderSource(a.j,a.s);a.g.compileShader(a.j);a.g.getShaderParameter(a.j,35713)||window.alert(u.h(a.g.getShaderInfoLog(a.j)+"\nsource:\n"+a.s));a.g.shaderSource(a.h,a.o);a.g.compileShader(a.h);a.g.getShaderParameter(a.h,35713)||window.alert(u.h(a.g.getShaderInfoLog(a.h)+"\nsource:\n"+a.o));a.g.attachShader(a.l,a.j);a.g.attachShader(a.l,a.h);a.g.linkProgram(a.l);a.g.getProgramParameter(a.l,35714)?a.u=!0:g.console.log("link failed: "+a.g.getProgramInfoLog(a.l));this.L=a;a=new C(this.v.g);
a.s="\r\n\t\t\tattribute vec4 position;\r\n\t\t\tattribute vec2 texCoord;\r\n\t\t\tuniform mat4 transform;\r\n\t\t\tuniform float invTexSize;\r\n\t\t\t\r\n\t\t\tvarying vec2 uv;\r\n\t\t\tvarying vec2 uvL;\r\n\t\t\tvarying vec2 uvR;\r\n\t\t\tvarying vec2 uvT;\r\n\t\t\tvarying vec2 uvB;\r\n\r\n\t\t\tvoid main() {\r\n\t\t\t\tgl_Position = transform * position;\r\n\t\t\t\tuv = texCoord;\r\n\t\t\t\tuvL = uv + vec2(-1, 0) * invTexSize;\r\n\t\t\t\tuvR = uv + vec2( 1, 0) * invTexSize;\r\n\t\t\t\tuvT = uv + vec2(0, -1) * invTexSize;\r\n\t\t\t\tuvB = uv + vec2(0,  1) * invTexSize;\r\n\t\t\t}\r\n\t\t";
a.u=!1;a.o="\r\n\t\t\tprecision highp float;\r\n\t\t\tuniform float texSize;\r\n\t\t\tuniform float invTexSize;\r\n\t\t\tuniform ivec2 resolution;\r\n\t\t\tvarying vec2 uv;\r\n\t\t\tvarying vec2 uvL;\r\n\t\t\tvarying vec2 uvR;\r\n\t\t\tvarying vec2 uvT;\r\n\t\t\tvarying vec2 uvB; \r\n\t\t\r\n\t\t\tuniform sampler2D vel;\r\n\t\t\tuniform sampler2D vof;\r\n\t\t\tuniform sampler2D room;\r\n\t\t\t\r\n\t\t\tvoid main() {\r\n\t\t\t\tvec2 lt = texture2D(vel, uv).xy;\r\n\t\t\t\tfloat r = texture2D(vel, uvR).x;\r\n\t\t\t\tfloat b = texture2D(vel, uvB).y;\r\n\t\t\t\tfloat div = r + b - lt.x - lt.y;\r\n\t\t\t\t\r\n\t\t\t\tvec2 vof = texture2D(vof, uv).xy;\r\n\t\t\t\tfloat vsrc = vof.x + vof.y - texture2D(room, uv).x;\r\n\t\t\t\t\r\n\t\t\t\tgl_FragColor = vec4(-div, vsrc, 0, 0);\r\n\t\t\t}\r\n\t\t";
a.u=!1;a.map=new E;a.g.shaderSource(a.j,a.s);a.g.compileShader(a.j);a.g.getShaderParameter(a.j,35713)||window.alert(u.h(a.g.getShaderInfoLog(a.j)+"\nsource:\n"+a.s));a.g.shaderSource(a.h,a.o);a.g.compileShader(a.h);a.g.getShaderParameter(a.h,35713)||window.alert(u.h(a.g.getShaderInfoLog(a.h)+"\nsource:\n"+a.o));a.g.attachShader(a.l,a.j);a.g.attachShader(a.l,a.h);a.g.linkProgram(a.l);a.g.getProgramParameter(a.l,35714)?a.u=!0:g.console.log("link failed: "+a.g.getProgramInfoLog(a.l));this.Ca=a;a=new C(this.v.g);
a.s="\r\n\t\t\tattribute vec4 position;\r\n\t\t\tattribute vec2 texCoord;\r\n\t\t\tuniform mat4 transform;\r\n\t\t\tuniform float invTexSize;\r\n\t\t\t\r\n\t\t\tvarying vec2 uv;\r\n\t\t\tvarying vec2 uvL;\r\n\t\t\tvarying vec2 uvR;\r\n\t\t\tvarying vec2 uvT;\r\n\t\t\tvarying vec2 uvB;\r\n\r\n\t\t\tvoid main() {\r\n\t\t\t\tgl_Position = transform * position;\r\n\t\t\t\tuv = texCoord;\r\n\t\t\t\tuvL = uv + vec2(-1, 0) * invTexSize;\r\n\t\t\t\tuvR = uv + vec2( 1, 0) * invTexSize;\r\n\t\t\t\tuvT = uv + vec2(0, -1) * invTexSize;\r\n\t\t\t\tuvB = uv + vec2(0,  1) * invTexSize;\r\n\t\t\t}\r\n\t\t";
a.u=!1;a.o="\r\n\t\t\tprecision highp float;\r\n\t\t\tuniform float texSize;\r\n\t\t\tuniform float invTexSize;\r\n\t\t\tuniform ivec2 resolution;\r\n\t\t\tvarying vec2 uv;\r\n\t\t\tvarying vec2 uvL;\r\n\t\t\tvarying vec2 uvR;\r\n\t\t\tvarying vec2 uvT;\r\n\t\t\tvarying vec2 uvB; \r\n\t\t\r\n\t\t\tuniform sampler2D room;\r\n\t\t\t\r\n\t\t\tvoid main() {\r\n\t\t\t\tfloat c = texture2D(room, uv).x;\r\n\t\t\t\tfloat l = texture2D(room, uvL).x;\r\n\t\t\t\tfloat t = texture2D(room, uvT).x;\r\n\t\t\t\tgl_FragColor = vec4(min(c, l), min(c, t), 0, 0);\r\n\t\t\t}\r\n\t\t";
a.u=!1;a.map=new E;a.g.shaderSource(a.j,a.s);a.g.compileShader(a.j);a.g.getShaderParameter(a.j,35713)||window.alert(u.h(a.g.getShaderInfoLog(a.j)+"\nsource:\n"+a.s));a.g.shaderSource(a.h,a.o);a.g.compileShader(a.h);a.g.getShaderParameter(a.h,35713)||window.alert(u.h(a.g.getShaderInfoLog(a.h)+"\nsource:\n"+a.o));a.g.attachShader(a.l,a.j);a.g.attachShader(a.l,a.h);a.g.linkProgram(a.l);a.g.getProgramParameter(a.l,35714)?a.u=!0:g.console.log("link failed: "+a.g.getProgramInfoLog(a.l));this.Ya=a;a=new C(this.v.g);
a.s="\r\n\t\t\tattribute vec4 position;\r\n\t\t\tattribute vec2 texCoord;\r\n\t\t\tuniform mat4 transform;\r\n\t\t\tuniform float invTexSize;\r\n\t\t\t\r\n\t\t\tvarying vec2 uv;\r\n\t\t\tvarying vec2 uvL;\r\n\t\t\tvarying vec2 uvR;\r\n\t\t\tvarying vec2 uvT;\r\n\t\t\tvarying vec2 uvB;\r\n\r\n\t\t\tvoid main() {\r\n\t\t\t\tgl_Position = transform * position;\r\n\t\t\t\tuv = texCoord;\r\n\t\t\t\tuvL = uv + vec2(-1, 0) * invTexSize;\r\n\t\t\t\tuvR = uv + vec2( 1, 0) * invTexSize;\r\n\t\t\t\tuvT = uv + vec2(0, -1) * invTexSize;\r\n\t\t\t\tuvB = uv + vec2(0,  1) * invTexSize;\r\n\t\t\t}\r\n\t\t";
a.u=!1;a.o="\r\n\t\t\tprecision highp float;\r\n\t\t\tuniform float texSize;\r\n\t\t\tuniform float invTexSize;\r\n\t\t\tuniform ivec2 resolution;\r\n\t\t\tvarying vec2 uv;\r\n\t\t\tvarying vec2 uvL;\r\n\t\t\tvarying vec2 uvR;\r\n\t\t\tvarying vec2 uvT;\r\n\t\t\tvarying vec2 uvB; \r\n\t\t\r\n\t\t\tuniform sampler2D room;\r\n\t\t\t\r\n\t\t\tvoid main() {\r\n\t\t\t\tvec2 min = vec2(0);\r\n\t\t\t\tvec2 max = vec2(0);\r\n\t\t\t\tfloat coeff;\r\n\t\t\t\t\r\n\t\t\t\tcoeff = 1.0;\r\n\t\t\t\tfor (int i = 0; i <= 2; i++) {\r\n\t\t\t\t\tfor (int j = -0; j <= 0; j++) {\r\n\t\t\t\t\t\tif (texture2D(room, uvL - vec2(i, j) * invTexSize).x < 0.1) {\r\n\t\t\t\t\t\t\tcoeff = 0.0;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif (i != 0) min.x -= coeff;\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\tcoeff = 1.0;\r\n\t\t\t\tfor (int i = 0; i <= 2; i++) {\r\n\t\t\t\t\tfor (int j = -0; j <= 0; j++) {\r\n\t\t\t\t\t\tif (texture2D(room, uvT - vec2(j, i) * invTexSize).x < 0.1) {\r\n\t\t\t\t\t\t\tcoeff = 0.0;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif (i != 0) min.y -= coeff;\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\tcoeff = 1.0;\r\n\t\t\t\tfor (int i = 0; i <= 2; i++) {\r\n\t\t\t\t\tfor (int j = -0; j <= 0; j++) {\r\n\t\t\t\t\t\tif (texture2D(room, uv + vec2(i, j) * invTexSize).x < 0.1) {\r\n\t\t\t\t\t\t\tcoeff = 0.0;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif (i != 0) max.x += coeff;\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\tcoeff = 1.0;\r\n\t\t\t\tfor (int i = 0; i <= 2; i++) {\r\n\t\t\t\t\tfor (int j = -0; j <= 0; j++) {\r\n\t\t\t\t\t\tif (texture2D(room, uv + vec2(j, i) * invTexSize).x < 0.1) {\r\n\t\t\t\t\t\t\tcoeff = 0.0;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif (i != 0) max.y += coeff;\r\n\t\t\t\t}\r\n\t\t\t\tgl_FragColor = vec4(min, max);\r\n\t\t\t}\r\n\t\t";
a.u=!1;a.map=new E;a.g.shaderSource(a.j,a.s);a.g.compileShader(a.j);a.g.getShaderParameter(a.j,35713)||window.alert(u.h(a.g.getShaderInfoLog(a.j)+"\nsource:\n"+a.s));a.g.shaderSource(a.h,a.o);a.g.compileShader(a.h);a.g.getShaderParameter(a.h,35713)||window.alert(u.h(a.g.getShaderInfoLog(a.h)+"\nsource:\n"+a.o));a.g.attachShader(a.l,a.j);a.g.attachShader(a.l,a.h);a.g.linkProgram(a.l);a.g.getProgramParameter(a.l,35714)?a.u=!0:g.console.log("link failed: "+a.g.getProgramInfoLog(a.l));this.Ra=a;a=new C(this.v.g);
a.s="\r\n\t\t\tattribute vec4 position;\r\n\t\t\tattribute vec2 texCoord;\r\n\t\t\tuniform mat4 transform;\r\n\t\t\tuniform float invTexSize;\r\n\t\t\t\r\n\t\t\tvarying vec2 uv;\r\n\t\t\tvarying vec2 uvL;\r\n\t\t\tvarying vec2 uvR;\r\n\t\t\tvarying vec2 uvT;\r\n\t\t\tvarying vec2 uvB;\r\n\r\n\t\t\tvoid main() {\r\n\t\t\t\tgl_Position = transform * position;\r\n\t\t\t\tuv = texCoord;\r\n\t\t\t\tuvL = uv + vec2(-1, 0) * invTexSize;\r\n\t\t\t\tuvR = uv + vec2( 1, 0) * invTexSize;\r\n\t\t\t\tuvT = uv + vec2(0, -1) * invTexSize;\r\n\t\t\t\tuvB = uv + vec2(0,  1) * invTexSize;\r\n\t\t\t}\r\n\t\t";
a.u=!1;a.o="\r\n\t\t\tprecision highp float;\r\n\t\t\tuniform float texSize;\r\n\t\t\tuniform float invTexSize;\r\n\t\t\tuniform ivec2 resolution;\r\n\t\t\tvarying vec2 uv;\r\n\t\t\tvarying vec2 uvL;\r\n\t\t\tvarying vec2 uvR;\r\n\t\t\tvarying vec2 uvT;\r\n\t\t\tvarying vec2 uvB; \r\n\t\t\r\n\t\t\tuniform sampler2D weight;\r\n\t\t\t\r\n\t\t\tvoid main() {\r\n\t\t\t\tvec2 lt = texture2D(weight, uv).xy;\r\n\t\t\t\tfloat r = texture2D(weight, uvR).x;\r\n\t\t\t\tfloat b = texture2D(weight, uvB).y;\r\n\t\t\t\tgl_FragColor = vec4(lt, r, b);\r\n\t\t\t}\r\n\t\t";
a.u=!1;a.map=new E;a.g.shaderSource(a.j,a.s);a.g.compileShader(a.j);a.g.getShaderParameter(a.j,35713)||window.alert(u.h(a.g.getShaderInfoLog(a.j)+"\nsource:\n"+a.s));a.g.shaderSource(a.h,a.o);a.g.compileShader(a.h);a.g.getShaderParameter(a.h,35713)||window.alert(u.h(a.g.getShaderInfoLog(a.h)+"\nsource:\n"+a.o));a.g.attachShader(a.l,a.j);a.g.attachShader(a.l,a.h);a.g.linkProgram(a.l);a.g.getProgramParameter(a.l,35714)?a.u=!0:g.console.log("link failed: "+a.g.getProgramInfoLog(a.l));this.Da=a;a=new C(this.v.g);
a.s="\r\n\t\t\tattribute vec4 position;\r\n\t\t\tattribute vec2 texCoord;\r\n\t\t\tuniform mat4 transform;\r\n\t\t\tuniform float invTexSize;\r\n\t\t\t\r\n\t\t\tvarying vec2 uv;\r\n\t\t\tvarying vec2 uvL;\r\n\t\t\tvarying vec2 uvR;\r\n\t\t\tvarying vec2 uvT;\r\n\t\t\tvarying vec2 uvB;\r\n\r\n\t\t\tvoid main() {\r\n\t\t\t\tgl_Position = transform * position;\r\n\t\t\t\tuv = texCoord;\r\n\t\t\t\tuvL = uv + vec2(-1, 0) * invTexSize;\r\n\t\t\t\tuvR = uv + vec2( 1, 0) * invTexSize;\r\n\t\t\t\tuvT = uv + vec2(0, -1) * invTexSize;\r\n\t\t\t\tuvB = uv + vec2(0,  1) * invTexSize;\r\n\t\t\t}\r\n\t\t";
a.u=!1;a.o="\r\n\t\t\tprecision highp float;\r\n\t\t\tuniform float texSize;\r\n\t\t\tuniform float invTexSize;\r\n\t\t\tuniform ivec2 resolution;\r\n\t\t\tvarying vec2 uv;\r\n\t\t\tvarying vec2 uvL;\r\n\t\t\tvarying vec2 uvR;\r\n\t\t\tvarying vec2 uvT;\r\n\t\t\tvarying vec2 uvB; \r\n\t\t\r\n\t\t\tuniform sampler2D psol;\r\n\t\t\t\r\n\t\t\tvoid main() {\r\n\t\t\t\tvec2 scales = vec2(0.98, 0.98);\r\n\t\t\t\tvec2 offset = texture2D(psol, vec2(0.5)).xy;\r\n\t\t\t\tgl_FragColor = vec4((texture2D(psol, uv).xy - offset) * scales, 0, 0);\r\n\t\t\t}\r\n\t\t";
a.u=!1;a.map=new E;a.g.shaderSource(a.j,a.s);a.g.compileShader(a.j);a.g.getShaderParameter(a.j,35713)||window.alert(u.h(a.g.getShaderInfoLog(a.j)+"\nsource:\n"+a.s));a.g.shaderSource(a.h,a.o);a.g.compileShader(a.h);a.g.getShaderParameter(a.h,35713)||window.alert(u.h(a.g.getShaderInfoLog(a.h)+"\nsource:\n"+a.o));a.g.attachShader(a.l,a.j);a.g.attachShader(a.l,a.h);a.g.linkProgram(a.l);a.g.getProgramParameter(a.l,35714)?a.u=!0:g.console.log("link failed: "+a.g.getProgramInfoLog(a.l));this.$a=a;a=new C(this.v.g);
a.s="\r\n\t\t\tattribute vec4 position;\r\n\t\t\tattribute vec2 texCoord;\r\n\t\t\tuniform mat4 transform;\r\n\t\t\tuniform float invTexSize;\r\n\t\t\t\r\n\t\t\tvarying vec2 uv;\r\n\t\t\tvarying vec2 uvL;\r\n\t\t\tvarying vec2 uvR;\r\n\t\t\tvarying vec2 uvT;\r\n\t\t\tvarying vec2 uvB;\r\n\r\n\t\t\tvoid main() {\r\n\t\t\t\tgl_Position = transform * position;\r\n\t\t\t\tuv = texCoord;\r\n\t\t\t\tuvL = uv + vec2(-1, 0) * invTexSize;\r\n\t\t\t\tuvR = uv + vec2( 1, 0) * invTexSize;\r\n\t\t\t\tuvT = uv + vec2(0, -1) * invTexSize;\r\n\t\t\t\tuvB = uv + vec2(0,  1) * invTexSize;\r\n\t\t\t}\r\n\t\t";
a.u=!1;a.o="\r\n\t\t\tprecision highp float;\r\n\t\t\tuniform float texSize;\r\n\t\t\tuniform float invTexSize;\r\n\t\t\tuniform ivec2 resolution;\r\n\t\t\tvarying vec2 uv;\r\n\t\t\tvarying vec2 uvL;\r\n\t\t\tvarying vec2 uvR;\r\n\t\t\tvarying vec2 uvT;\r\n\t\t\tvarying vec2 uvB; \r\n\t\t\r\n\t\t\tuniform sampler2D pweight;\r\n\t\t\tuniform sampler2D psol;\r\n\t\t\tuniform sampler2D psrc;\r\n\t\t\t\r\n\t\t\tuniform float parity;\r\n\t\t\t\r\n\t\t\tvoid main() {\r\n\t\t\t\tif (mod(dot(floor(uv * texSize), vec2(1)) + parity + 0.5, 2.0) > 1.0) {\r\n\t\t\t\t\tgl_FragColor = texture2D(psol, uv);\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\tvec4 w = texture2D(pweight, uv);\r\n\t\t\t\tfloat denom = dot(w, vec4(1));\r\n\t\t\t\tif (denom < 1e-4) {\r\n\t\t\t\t\tgl_FragColor = vec4(0);\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\tvec2 sol = texture2D(psol, uv).xy;\r\n\t\t\t\tvec2 solL = texture2D(psol, uvL).xy;\r\n\t\t\t\tvec2 solT = texture2D(psol, uvT).xy;\r\n\t\t\t\tvec2 solR = texture2D(psol, uvR).xy;\r\n\t\t\t\tvec2 solB = texture2D(psol, uvB).xy;\r\n\t\t\t\tvec2 src = texture2D(psrc, uv).xy;\r\n\t\t\t\t\r\n\t\t\t\tvec4 solsX = vec4(solL.x, solT.x, solR.x, solB.x);\r\n\t\t\t\tvec4 solsY = vec4(solL.y, solT.y, solR.y, solB.y);\r\n\t\t\t\tvec2 numers = vec2(dot(solsX * w, vec4(1)), dot(solsY * w, vec4(1))) + src;\r\n\t\t\t\tvec2 nsol = numers / denom;\r\n\t\t\t\tvec2 diff = nsol - sol;\r\n\t\t\t\tgl_FragColor = vec4(sol + diff * 1.4, 0, 0);\r\n\t\t\t}\r\n\t\t";
a.u=!1;a.map=new E;a.g.shaderSource(a.j,a.s);a.g.compileShader(a.j);a.g.getShaderParameter(a.j,35713)||window.alert(u.h(a.g.getShaderInfoLog(a.j)+"\nsource:\n"+a.s));a.g.shaderSource(a.h,a.o);a.g.compileShader(a.h);a.g.getShaderParameter(a.h,35713)||window.alert(u.h(a.g.getShaderInfoLog(a.h)+"\nsource:\n"+a.o));a.g.attachShader(a.l,a.j);a.g.attachShader(a.l,a.h);a.g.linkProgram(a.l);a.g.getProgramParameter(a.l,35714)?a.u=!0:g.console.log("link failed: "+a.g.getProgramInfoLog(a.l));this.o=a;a=new C(this.v.g);
a.s="\r\n\t\t\tattribute vec4 position;\r\n\t\t\tattribute vec2 texCoord;\r\n\t\t\tuniform mat4 transform;\r\n\t\t\tuniform float invTexSize;\r\n\t\t\t\r\n\t\t\tvarying vec2 uv;\r\n\t\t\tvarying vec2 uvL;\r\n\t\t\tvarying vec2 uvR;\r\n\t\t\tvarying vec2 uvT;\r\n\t\t\tvarying vec2 uvB;\r\n\r\n\t\t\tvoid main() {\r\n\t\t\t\tgl_Position = transform * position;\r\n\t\t\t\tuv = texCoord;\r\n\t\t\t\tuvL = uv + vec2(-1, 0) * invTexSize;\r\n\t\t\t\tuvR = uv + vec2( 1, 0) * invTexSize;\r\n\t\t\t\tuvT = uv + vec2(0, -1) * invTexSize;\r\n\t\t\t\tuvB = uv + vec2(0,  1) * invTexSize;\r\n\t\t\t}\r\n\t\t";
a.u=!1;a.o="\r\n\t\t\tprecision highp float;\r\n\t\t\tuniform float texSize;\r\n\t\t\tuniform float invTexSize;\r\n\t\t\tuniform ivec2 resolution;\r\n\t\t\tvarying vec2 uv;\r\n\t\t\tvarying vec2 uvL;\r\n\t\t\tvarying vec2 uvR;\r\n\t\t\tvarying vec2 uvT;\r\n\t\t\tvarying vec2 uvB; \r\n\t\t\r\n\t\t\tuniform sampler2D vel;\r\n\t\t\tuniform sampler2D lim;\r\n\t\t\tuniform sampler2D psol;\r\n\t\t\tuniform sampler2D weight;\r\n\r\n\t\t\tvoid main() {\r\n\t\t\t\tvec2 v = texture2D(vel, uv).xy;\r\n\t\t\t\tfloat c = texture2D(psol, uv).x;\r\n\t\t\t\tfloat l = texture2D(psol, uvL).x;\r\n\t\t\t\tfloat t = texture2D(psol, uvT).x;\r\n\t\t\t\tvec2 wlt = texture2D(weight, uv).xy;\r\n\t\t\t\tv += vec2(l - c, t - c) * wlt;\r\n\t\t\t\t\r\n\t\t\t\tvec4 lim = texture2D(lim, uv);\r\n\t\t\t\tv = max(lim.xy, min(lim.zw, v));\r\n\t\t\t\t\r\n\t\t\t\tgl_FragColor = vec4(v, 0, 0);\r\n\t\t\t}\r\n\t\t";
a.u=!1;a.map=new E;a.g.shaderSource(a.j,a.s);a.g.compileShader(a.j);a.g.getShaderParameter(a.j,35713)||window.alert(u.h(a.g.getShaderInfoLog(a.j)+"\nsource:\n"+a.s));a.g.shaderSource(a.h,a.o);a.g.compileShader(a.h);a.g.getShaderParameter(a.h,35713)||window.alert(u.h(a.g.getShaderInfoLog(a.h)+"\nsource:\n"+a.o));a.g.attachShader(a.l,a.j);a.g.attachShader(a.l,a.h);a.g.linkProgram(a.l);a.g.getProgramParameter(a.l,35714)?a.u=!0:g.console.log("link failed: "+a.g.getProgramInfoLog(a.l));this.Aa=a;a=new C(this.v.g);
a.s="\r\n\t\t\tattribute vec4 position;\r\n\t\t\tattribute vec2 texCoord;\r\n\t\t\tuniform mat4 transform;\r\n\t\t\tuniform float invTexSize;\r\n\t\t\t\r\n\t\t\tvarying vec2 uv;\r\n\t\t\tvarying vec2 uvL;\r\n\t\t\tvarying vec2 uvR;\r\n\t\t\tvarying vec2 uvT;\r\n\t\t\tvarying vec2 uvB;\r\n\r\n\t\t\tvoid main() {\r\n\t\t\t\tgl_Position = transform * position;\r\n\t\t\t\tuv = texCoord;\r\n\t\t\t\tuvL = uv + vec2(-1, 0) * invTexSize;\r\n\t\t\t\tuvR = uv + vec2( 1, 0) * invTexSize;\r\n\t\t\t\tuvT = uv + vec2(0, -1) * invTexSize;\r\n\t\t\t\tuvB = uv + vec2(0,  1) * invTexSize;\r\n\t\t\t}\r\n\t\t";
a.u=!1;a.o="\r\n\t\t\tprecision highp float;\r\n\t\t\tuniform float texSize;\r\n\t\t\tuniform float invTexSize;\r\n\t\t\tuniform ivec2 resolution;\r\n\t\t\tvarying vec2 uv;\r\n\t\t\tvarying vec2 uvL;\r\n\t\t\tvarying vec2 uvR;\r\n\t\t\tvarying vec2 uvT;\r\n\t\t\tvarying vec2 uvB; \r\n\t\t\r\n\t\t\tuniform sampler2D vof;\r\n\t\t\tuniform sampler2D psol;\r\n\t\t\tuniform sampler2D weight;\r\n\r\n\t\t\tvoid main() {\r\n\t\t\t\tvec2 vof = texture2D(vof, uv).xy;\r\n\t\t\t\tfloat c = texture2D(psol, uv).y;\r\n\t\t\t\tfloat l = texture2D(psol, uvL).y;\r\n\t\t\t\tfloat t = texture2D(psol, uvT).y;\r\n\t\t\t\tvec2 wlt = texture2D(weight, uv).xy;\r\n\t\t\t\tvec2 dv = vec2(l - c, t - c) * wlt;\r\n\t\t\t\tgl_FragColor = vec4(dv, vof);\r\n\t\t\t}\r\n\t\t";
a.u=!1;a.map=new E;a.g.shaderSource(a.j,a.s);a.g.compileShader(a.j);a.g.getShaderParameter(a.j,35713)||window.alert(u.h(a.g.getShaderInfoLog(a.j)+"\nsource:\n"+a.s));a.g.shaderSource(a.h,a.o);a.g.compileShader(a.h);a.g.getShaderParameter(a.h,35713)||window.alert(u.h(a.g.getShaderInfoLog(a.h)+"\nsource:\n"+a.o));a.g.attachShader(a.l,a.j);a.g.attachShader(a.l,a.h);a.g.linkProgram(a.l);a.g.getProgramParameter(a.l,35714)?a.u=!0:g.console.log("link failed: "+a.g.getProgramInfoLog(a.l));this.Ba=a;a=new C(this.v.g);
a.s="\r\n\t\t\tattribute vec4 position;\r\n\t\t\tattribute vec2 texCoord;\r\n\t\t\tuniform mat4 transform;\r\n\t\t\tuniform float invTexSize;\r\n\t\t\t\r\n\t\t\tvarying vec2 uv;\r\n\t\t\tvarying vec2 uvL;\r\n\t\t\tvarying vec2 uvR;\r\n\t\t\tvarying vec2 uvT;\r\n\t\t\tvarying vec2 uvB;\r\n\r\n\t\t\tvoid main() {\r\n\t\t\t\tgl_Position = transform * position;\r\n\t\t\t\tuv = texCoord;\r\n\t\t\t\tuvL = uv + vec2(-1, 0) * invTexSize;\r\n\t\t\t\tuvR = uv + vec2( 1, 0) * invTexSize;\r\n\t\t\t\tuvT = uv + vec2(0, -1) * invTexSize;\r\n\t\t\t\tuvB = uv + vec2(0,  1) * invTexSize;\r\n\t\t\t}\r\n\t\t";
a.u=!1;a.o="\r\n\t\t\tprecision highp float;\r\n\t\t\tuniform float texSize;\r\n\t\t\tuniform float invTexSize;\r\n\t\t\tuniform ivec2 resolution;\r\n\t\t\tvarying vec2 uv;\r\n\t\t\tvarying vec2 uvL;\r\n\t\t\tvarying vec2 uvR;\r\n\t\t\tvarying vec2 uvT;\r\n\t\t\tvarying vec2 uvB; \r\n\t\t\r\n\t\t\tuniform sampler2D flx;\r\n\t\t\t\r\n\t\t\tfloat fluxScale(vec2 uv) {\r\n\t\t\t\tvec4 c = texture2D(flx, uv);\r\n\t\t\t\tvec2 lt = -c.xy;\r\n\t\t\t\tfloat r = texture2D(flx, uv + vec2(1, 0) * invTexSize).x;\r\n\t\t\t\tfloat b = texture2D(flx, uv + vec2(0, 1) * invTexSize).y;\r\n\t\t\t\tvec4 tmp = max(vec4(lt, r, b), 0.0);\r\n\t\t\t\ttmp.xy += tmp.zw;\r\n\t\t\t\tfloat outflow = tmp.x + tmp.y + 1e-4;\r\n\t\t\t\tfloat available = c.z + c.w;\r\n\t\t\t\treturn min(1.0, available / outflow);\r\n\t\t\t}\r\n\r\n\t\t\tvoid main() {\r\n\t\t\t\tvec4 c = texture2D(flx, uv);\r\n\t\t\t\tvec2 fxy = c.xy;\r\n\t\t\t\t\r\n\t\t\t\tif (fxy.x < 0.0 && fxy.y < 0.0) {\r\n\t\t\t\t\t// left <- center\r\n\t\t\t\t\t// top <- center\r\n\t\t\t\t\tfloat scale = fluxScale(uv);\r\n\t\t\t\t\tfxy *= scale;\r\n\t\t\t\t} else {\r\n\t\t\t\t\tif (fxy.x < 0.0) {\r\n\t\t\t\t\t\t// left <- center\r\n\t\t\t\t\t\tfxy.x *= fluxScale(uv);\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\t// left -> center\r\n\t\t\t\t\t\tfxy.x *= fluxScale(uvL);\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif (fxy.y < 0.0) {\r\n\t\t\t\t\t\t// top <- center\r\n\t\t\t\t\t\tfxy.y *= fluxScale(uv);\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\t// top -> center\r\n\t\t\t\t\t\tfxy.y *= fluxScale(uvT);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tgl_FragColor = vec4(fxy, c.zw);\r\n\t\t\t}\r\n\t\t";
a.u=!1;a.map=new E;a.g.shaderSource(a.j,a.s);a.g.compileShader(a.j);a.g.getShaderParameter(a.j,35713)||window.alert(u.h(a.g.getShaderInfoLog(a.j)+"\nsource:\n"+a.s));a.g.shaderSource(a.h,a.o);a.g.compileShader(a.h);a.g.getShaderParameter(a.h,35713)||window.alert(u.h(a.g.getShaderInfoLog(a.h)+"\nsource:\n"+a.o));a.g.attachShader(a.l,a.j);a.g.attachShader(a.l,a.h);a.g.linkProgram(a.l);a.g.getProgramParameter(a.l,35714)?a.u=!0:g.console.log("link failed: "+a.g.getProgramInfoLog(a.l));this.Ma=a;a=new C(this.v.g);
a.s="\r\n\t\t\tattribute vec4 position;\r\n\t\t\tattribute vec2 texCoord;\r\n\t\t\tuniform mat4 transform;\r\n\t\t\tuniform float invTexSize;\r\n\t\t\t\r\n\t\t\tvarying vec2 uv;\r\n\t\t\tvarying vec2 uvL;\r\n\t\t\tvarying vec2 uvR;\r\n\t\t\tvarying vec2 uvT;\r\n\t\t\tvarying vec2 uvB;\r\n\r\n\t\t\tvoid main() {\r\n\t\t\t\tgl_Position = transform * position;\r\n\t\t\t\tuv = texCoord;\r\n\t\t\t\tuvL = uv + vec2(-1, 0) * invTexSize;\r\n\t\t\t\tuvR = uv + vec2( 1, 0) * invTexSize;\r\n\t\t\t\tuvT = uv + vec2(0, -1) * invTexSize;\r\n\t\t\t\tuvB = uv + vec2(0,  1) * invTexSize;\r\n\t\t\t}\r\n\t\t";
a.u=!1;a.o="\r\n\t\t\tprecision highp float;\r\n\t\t\tuniform float texSize;\r\n\t\t\tuniform float invTexSize;\r\n\t\t\tuniform ivec2 resolution;\r\n\t\t\tvarying vec2 uv;\r\n\t\t\tvarying vec2 uvL;\r\n\t\t\tvarying vec2 uvR;\r\n\t\t\tvarying vec2 uvT;\r\n\t\t\tvarying vec2 uvB; \r\n\t\t\r\n\t\t\tuniform sampler2D vof;\r\n\t\t\tuniform sampler2D room;\r\n\t\t\t\r\n\t\t\tvoid main() {\r\n\t\t\t\tvec2 vof = texture2D(vof, uv).xy;\r\n\t\t\t\tfloat ratio = vof.x / (vof.x + vof.y + 1e-4);\r\n\t\t\t\tvof.x = ratio;\r\n\t\t\t\tvof.y = 1.0 - ratio;\r\n\t\t\t\tfloat room = texture2D(room, uv).x;\r\n\t\t\t\tvof *= room;\r\n\t\t\t\tgl_FragColor = vec4(vof, vof);\r\n\t\t\t}\r\n\t\t";
a.u=!1;a.map=new E;a.g.shaderSource(a.j,a.s);a.g.compileShader(a.j);a.g.getShaderParameter(a.j,35713)||window.alert(u.h(a.g.getShaderInfoLog(a.j)+"\nsource:\n"+a.s));a.g.shaderSource(a.h,a.o);a.g.compileShader(a.h);a.g.getShaderParameter(a.h,35713)||window.alert(u.h(a.g.getShaderInfoLog(a.h)+"\nsource:\n"+a.o));a.g.attachShader(a.l,a.j);a.g.attachShader(a.l,a.h);a.g.linkProgram(a.l);a.g.getProgramParameter(a.l,35714)?a.u=!0:g.console.log("link failed: "+a.g.getProgramInfoLog(a.l));this.Wa=a;a=new C(this.v.g);
a.s="\r\n\t\t\tattribute vec4 position;\r\n\t\t\tattribute vec2 texCoord;\r\n\t\t\tuniform mat4 transform;\r\n\t\t\tuniform float invTexSize;\r\n\t\t\t\r\n\t\t\tvarying vec2 uv;\r\n\t\t\tvarying vec2 uvL;\r\n\t\t\tvarying vec2 uvR;\r\n\t\t\tvarying vec2 uvT;\r\n\t\t\tvarying vec2 uvB;\r\n\r\n\t\t\tvoid main() {\r\n\t\t\t\tgl_Position = transform * position;\r\n\t\t\t\tuv = texCoord;\r\n\t\t\t\tuvL = uv + vec2(-1, 0) * invTexSize;\r\n\t\t\t\tuvR = uv + vec2( 1, 0) * invTexSize;\r\n\t\t\t\tuvT = uv + vec2(0, -1) * invTexSize;\r\n\t\t\t\tuvB = uv + vec2(0,  1) * invTexSize;\r\n\t\t\t}\r\n\t\t";
a.u=!1;a.o="\r\n\t\t\tprecision highp float;\r\n\t\t\tuniform float texSize;\r\n\t\t\tuniform float invTexSize;\r\n\t\t\tuniform ivec2 resolution;\r\n\t\t\tvarying vec2 uv;\r\n\t\t\tvarying vec2 uvL;\r\n\t\t\tvarying vec2 uvR;\r\n\t\t\tvarying vec2 uvT;\r\n\t\t\tvarying vec2 uvB; \r\n\t\t\r\n\t\t\tuniform sampler2D flx;\r\n\t\t\t\r\n\t\t\tvec2 ratio(vec2 vof) {\r\n\t\t\t\treturn vof / (vof.x + vof.y + 1e-4);\r\n\t\t\t}\r\n\r\n\t\t\tvoid main() {\r\n\t\t\t\tvec4 c = texture2D(flx, uv);\r\n\t\t\t\tvec4 l = texture2D(flx, uvL);\r\n\t\t\t\tvec4 t = texture2D(flx, uvT);\r\n\t\t\t\tvec4 r = texture2D(flx, uvR);\r\n\t\t\t\tvec4 b = texture2D(flx, uvB);\r\n\t\t\t\t\r\n\t\t\t\tvec4 flux = vec4(c.x, c.y, r.x, b.y); // L-T-R-B\r\n\t\t\t\tvec4 aflux = abs(flux);\r\n\t\t\t\t\r\n\t\t\t\tvec2 inflow = vec2(0);\r\n\t\t\t\tfloat outflow = 0.0;\r\n\t\t\t\t\r\n\t\t\t\tif (flux.x > 0.0) inflow  += ratio(l.zw) * aflux.x;\r\n\t\t\t\telse              outflow += aflux.x;\r\n\t\t\t\tif (flux.y > 0.0) inflow  += ratio(t.zw) * aflux.y;\r\n\t\t\t\telse              outflow += aflux.y;\r\n\t\t\t\tif (flux.z < 0.0) inflow  += ratio(r.zw) * aflux.z;\r\n\t\t\t\telse              outflow += aflux.z;\r\n\t\t\t\tif (flux.w < 0.0) inflow  += ratio(b.zw) * aflux.w;\r\n\t\t\t\telse              outflow += aflux.w;\r\n\t\t\t\tvec2 vof = c.zw;\r\n\t\t\t\tvec2 dvof = inflow - ratio(vof) * outflow;\r\n\t\t\t\tvof += dvof;\r\n\t\t\t\tvof = max(vec2(0), vof);\r\n\t\t\t\tgl_FragColor = vec4(vof, vof);\r\n\t\t\t}\r\n\t\t";
a.u=!1;a.map=new E;a.g.shaderSource(a.j,a.s);a.g.compileShader(a.j);a.g.getShaderParameter(a.j,35713)||window.alert(u.h(a.g.getShaderInfoLog(a.j)+"\nsource:\n"+a.s));a.g.shaderSource(a.h,a.o);a.g.compileShader(a.h);a.g.getShaderParameter(a.h,35713)||window.alert(u.h(a.g.getShaderInfoLog(a.h)+"\nsource:\n"+a.o));a.g.attachShader(a.l,a.j);a.g.attachShader(a.l,a.h);a.g.linkProgram(a.l);a.g.getProgramParameter(a.l,35714)?a.u=!0:g.console.log("link failed: "+a.g.getProgramInfoLog(a.l));this.za=a;a=new C(this.v.g);
a.s="\r\n\t\t\tattribute vec4 position;\r\n\t\t\tattribute vec2 texCoord;\r\n\t\t\tuniform mat4 transform;\r\n\t\t\tuniform float invTexSize;\r\n\t\t\t\r\n\t\t\tvarying vec2 uv;\r\n\t\t\tvarying vec2 uvL;\r\n\t\t\tvarying vec2 uvR;\r\n\t\t\tvarying vec2 uvT;\r\n\t\t\tvarying vec2 uvB;\r\n\r\n\t\t\tvoid main() {\r\n\t\t\t\tgl_Position = transform * position;\r\n\t\t\t\tuv = texCoord;\r\n\t\t\t\tuvL = uv + vec2(-1, 0) * invTexSize;\r\n\t\t\t\tuvR = uv + vec2( 1, 0) * invTexSize;\r\n\t\t\t\tuvT = uv + vec2(0, -1) * invTexSize;\r\n\t\t\t\tuvB = uv + vec2(0,  1) * invTexSize;\r\n\t\t\t}\r\n\t\t";
a.u=!1;a.o="\r\n\t\t\tprecision highp float;\r\n\t\t\tuniform float texSize;\r\n\t\t\tuniform float invTexSize;\r\n\t\t\tuniform ivec2 resolution;\r\n\t\t\tvarying vec2 uv;\r\n\t\t\tvarying vec2 uvL;\r\n\t\t\tvarying vec2 uvR;\r\n\t\t\tvarying vec2 uvT;\r\n\t\t\tvarying vec2 uvB; \r\n\t\t\r\n\t\t\tuniform sampler2D vof;\r\n\t\t\t\r\n\t\t\tvoid main() {\r\n\t\t\t\tvec4 raw = texture2D(vof, uv);\r\n\t\t\t\tvec4 reduced = texture2D(vof, uv * 2.0);\r\n\t\t\t\tgl_FragColor = vec4(raw.xy, reduced.zw);\r\n\t\t\t}\r\n\t\t";
a.u=!1;a.map=new E;a.g.shaderSource(a.j,a.s);a.g.compileShader(a.j);a.g.getShaderParameter(a.j,35713)||window.alert(u.h(a.g.getShaderInfoLog(a.j)+"\nsource:\n"+a.s));a.g.shaderSource(a.h,a.o);a.g.compileShader(a.h);a.g.getShaderParameter(a.h,35713)||window.alert(u.h(a.g.getShaderInfoLog(a.h)+"\nsource:\n"+a.o));a.g.attachShader(a.l,a.j);a.g.attachShader(a.l,a.h);a.g.linkProgram(a.l);a.g.getProgramParameter(a.l,35714)?a.u=!0:g.console.log("link failed: "+a.g.getProgramInfoLog(a.l));this.X=a;a=new C(this.v.g);
a.s="\r\n\t\t\tattribute vec4 position;\r\n\t\t\tattribute vec2 texCoord;\r\n\t\t\tuniform mat4 transform;\r\n\t\t\tuniform float invTexSize;\r\n\t\t\t\r\n\t\t\tvarying vec2 uv;\r\n\t\t\tvarying vec2 uvL;\r\n\t\t\tvarying vec2 uvR;\r\n\t\t\tvarying vec2 uvT;\r\n\t\t\tvarying vec2 uvB;\r\n\r\n\t\t\tvoid main() {\r\n\t\t\t\tgl_Position = transform * position;\r\n\t\t\t\tuv = texCoord;\r\n\t\t\t\tuvL = uv + vec2(-1, 0) * invTexSize;\r\n\t\t\t\tuvR = uv + vec2( 1, 0) * invTexSize;\r\n\t\t\t\tuvT = uv + vec2(0, -1) * invTexSize;\r\n\t\t\t\tuvB = uv + vec2(0,  1) * invTexSize;\r\n\t\t\t}\r\n\t\t";
a.u=!1;a.o="\r\n\t\t\tprecision highp float;\r\n\t\t\tuniform float texSize;\r\n\t\t\tuniform float invTexSize;\r\n\t\t\tuniform ivec2 resolution;\r\n\t\t\tvarying vec2 uv;\r\n\t\t\tvarying vec2 uvL;\r\n\t\t\tvarying vec2 uvR;\r\n\t\t\tvarying vec2 uvT;\r\n\t\t\tvarying vec2 uvB; \r\n\t\t\r\n\t\t\tuniform sampler2D vof;\r\n\t\t\tuniform sampler2D target;\r\n\t\t\tuniform sampler2D room;\r\n\t\t\t\r\n\t\t\tvec2 correctedVof(vec2 uv) {\r\n\t\t\t\tvec4 vof = texture2D(vof, uv);\r\n\t\t\t\tvec4 target = texture2D(target, uv);\r\n\t\t\t\tfloat room = texture2D(room, uv).x;\r\n\t\t\t\treturn vof.xy * target.zw / vof.zw * room;\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tvoid main() {\r\n\t\t\t\tvec2 v   = correctedVof(uv);\r\n\t\t\t\tvec2 vL  = correctedVof(uvL);\r\n\t\t\t\tvec2 vT  = correctedVof(uvT);\r\n\t\t\t\tgl_FragColor = vec4(v, (v + vL + vT) / 3.0);\r\n\t\t\t}\r\n\t\t";
a.u=!1;a.map=new E;a.g.shaderSource(a.j,a.s);a.g.compileShader(a.j);a.g.getShaderParameter(a.j,35713)||window.alert(u.h(a.g.getShaderInfoLog(a.j)+"\nsource:\n"+a.s));a.g.shaderSource(a.h,a.o);a.g.compileShader(a.h);a.g.getShaderParameter(a.h,35713)||window.alert(u.h(a.g.getShaderInfoLog(a.h)+"\nsource:\n"+a.o));a.g.attachShader(a.l,a.j);a.g.attachShader(a.l,a.h);a.g.linkProgram(a.l);a.g.getProgramParameter(a.l,35714)?a.u=!0:g.console.log("link failed: "+a.g.getProgramInfoLog(a.l));this.Pa=a;a=new C(this.v.g);
a.s="\r\n\t\t\tattribute vec4 position;\r\n\t\t\tattribute vec2 texCoord;\r\n\t\t\tuniform mat4 transform;\r\n\t\t\tuniform float invTexSize;\r\n\t\t\t\r\n\t\t\tvarying vec2 uv;\r\n\t\t\tvarying vec2 uvL;\r\n\t\t\tvarying vec2 uvR;\r\n\t\t\tvarying vec2 uvT;\r\n\t\t\tvarying vec2 uvB;\r\n\r\n\t\t\tvoid main() {\r\n\t\t\t\tgl_Position = transform * position;\r\n\t\t\t\tuv = texCoord;\r\n\t\t\t\tuvL = uv + vec2(-1, 0) * invTexSize;\r\n\t\t\t\tuvR = uv + vec2( 1, 0) * invTexSize;\r\n\t\t\t\tuvT = uv + vec2(0, -1) * invTexSize;\r\n\t\t\t\tuvB = uv + vec2(0,  1) * invTexSize;\r\n\t\t\t}\r\n\t\t";
a.u=!1;a.o="\r\n\t\t\tprecision highp float;\r\n\t\t\tuniform float texSize;\r\n\t\t\tuniform float invTexSize;\r\n\t\t\tuniform ivec2 resolution;\r\n\t\t\tvarying vec2 uv;\r\n\t\t\tvarying vec2 uvL;\r\n\t\t\tvarying vec2 uvR;\r\n\t\t\tvarying vec2 uvT;\r\n\t\t\tvarying vec2 uvB; \r\n\t\t\r\n\t\t\tuniform sampler2D vof;\r\n\t\t\t\r\n\t\t\tfloat col(vec2 uv) {\r\n\t\t\t\tvec2 vof = texture2D(vof, uv).zw;\r\n\t\t\t\tfloat t = vof.x / (vof.x + vof.y + 1e-4) * 2.0 - 1.0;\r\n\t\t\t\tfloat coeff = 1.0 + 20.0 * pow(1.0 - abs(uv.y - 0.5) * 2.0, 1.5);\r\n\t\t\t\tt = 1.0 / (1.0 + exp(-coeff * t));\r\n\t\t\t\tfloat min = 1.0 / (1.0 + exp(coeff));\r\n\t\t\t\tfloat max = 1.0 / (1.0 + exp(-coeff));\r\n\t\t\t\tt = (t - min) / (max - min);\r\n\t\t\t\t\r\n\t\t\t\tif (uv.y < 0.01) {\r\n\t\t\t\t\tt = 0.0;\r\n\t\t\t\t} else if (uv.y > 0.99) {\r\n\t\t\t\t\tt = 1.0;\r\n\t\t\t\t}\r\n\t\t\t\treturn t;\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tvoid main() {\r\n\t\t\t\tvec3 ratio = vec3(2, 1, 0);\r\n\t\t\t\tfloat u = uv.x;\r\n\t\t\t\tvec3 vs = 0.5 + (uv.y - 0.5) * (1.0 + ratio * 0.012);\r\n\t\t\t\tfloat tr = col(vec2(u, vs.x));\r\n\t\t\t\tfloat tg = col(vec2(u, vs.y));\r\n\t\t\t\tfloat tb = col(vec2(u, vs.z));\r\n\t\t\t\tgl_FragColor = vec4(tr, tg, tb, 1);\r\n\t\t\t}\r\n\t\t";
a.u=!1;a.map=new E;a.g.shaderSource(a.j,a.s);a.g.compileShader(a.j);a.g.getShaderParameter(a.j,35713)||window.alert(u.h(a.g.getShaderInfoLog(a.j)+"\nsource:\n"+a.s));a.g.shaderSource(a.h,a.o);a.g.compileShader(a.h);a.g.getShaderParameter(a.h,35713)||window.alert(u.h(a.g.getShaderInfoLog(a.h)+"\nsource:\n"+a.o));a.g.attachShader(a.l,a.j);a.g.attachShader(a.l,a.h);a.g.linkProgram(a.l);a.g.getProgramParameter(a.l,35714)?a.u=!0:g.console.log("link failed: "+a.g.getProgramInfoLog(a.l));this.Eb=a;a=new C(this.v.g);
a.s="\r\n\t\t\tattribute vec4 position;\r\n\t\t\tattribute vec2 texCoord;\r\n\t\t\tuniform mat4 transform;\r\n\t\t\tuniform float invTexSize;\r\n\t\t\t\r\n\t\t\tvarying vec2 uv;\r\n\t\t\tvarying vec2 uvL;\r\n\t\t\tvarying vec2 uvR;\r\n\t\t\tvarying vec2 uvT;\r\n\t\t\tvarying vec2 uvB;\r\n\r\n\t\t\tvoid main() {\r\n\t\t\t\tgl_Position = transform * position;\r\n\t\t\t\tuv = texCoord;\r\n\t\t\t\tuvL = uv + vec2(-1, 0) * invTexSize;\r\n\t\t\t\tuvR = uv + vec2( 1, 0) * invTexSize;\r\n\t\t\t\tuvT = uv + vec2(0, -1) * invTexSize;\r\n\t\t\t\tuvB = uv + vec2(0,  1) * invTexSize;\r\n\t\t\t}\r\n\t\t";
a.u=!1;a.o="\r\n\t\t\tprecision highp float;\r\n\t\t\tuniform float texSize;\r\n\t\t\tuniform float invTexSize;\r\n\t\t\tuniform ivec2 resolution;\r\n\t\t\tvarying vec2 uv;\r\n\t\t\tvarying vec2 uvL;\r\n\t\t\tvarying vec2 uvR;\r\n\t\t\tvarying vec2 uvT;\r\n\t\t\tvarying vec2 uvB; \r\n\t\t\r\n\t\t\tuniform sampler2D vof;\r\n\t\t\tuniform sampler2D vel;\r\n\t\t\tuniform sampler2D psrc;\r\n\t\t\tuniform sampler2D psol;\r\n\t\t\t// uniform sampler2D flx;\r\n\t\t\tuniform sampler2D room;\r\n\t\t\tuniform sampler2D target;\r\n\t\t\tuniform sampler2D lim;\r\n\t\t\t// uniform sampler2D weight;\r\n\t\t\tuniform sampler2D pweight;\r\n\t\t\t\r\n\t\t\tfloat curl(vec2 uv) {\r\n\t\t\t\tvec2 rb = texture2D(vel, uv).xy;\r\n\t\t\t\tfloat l = texture2D(vel, uv - vec2(1, 0) * invTexSize).y;\r\n\t\t\t\tfloat t = texture2D(vel, uv - vec2(0, 1) * invTexSize).x;\r\n\t\t\t\treturn l - rb.y + rb.x - t;\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tvec2 dir(vec2 uv) {\r\n\t\t\t\tfloat dx = curl(uv - vec2(0, 1) * invTexSize) - curl(uv + vec2(0, 1) * invTexSize);\r\n\t\t\t\tfloat dy = curl(uv + vec2(1, 0) * invTexSize) - curl(uv - vec2(1, 0) * invTexSize);\r\n\t\t\t\tvec2 d = vec2(dx, dy);\r\n\t\t\t\treturn d / (length(d) + 1e-4);\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tvec2 vc() {\r\n\t\t\t\tvec2 dc = dir(uv);\r\n\t\t\t\tvec2 db = dir(uvB);\r\n\t\t\t\tvec2 dr = dir(uvR);\r\n\t\t\t\tfloat dx = (dc + db).x * 0.5;\r\n\t\t\t\tfloat dy = (dc + dr).y * 0.5;\r\n\t\t\t\tfloat cc = curl(uv);\r\n\t\t\t\tfloat cb = curl(uvB);\r\n\t\t\t\tfloat cr = curl(uvR);\r\n\t\t\t\tfloat cx = (cc + cb) * 0.5;\r\n\t\t\t\tfloat cy = (cc + cr) * 0.5;\r\n\t\t\t\treturn vec2(dx * cx, dy * cy);\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tvec3 shouldBool(float v) {\r\n\t\t\t\treturn v == 0.0 ? vec3(0) : v == 1.0 ? vec3(1) : vec3(1.0 - v, v, 1);\r\n\t\t\t}\r\n\r\n\t\t\tvoid main() {\r\n\t\t\t\tvec2 crd = mod(uv * 4.0, 1.0);\r\n\t\t\t\t\r\n\t\t\t\t//crd = (floor(crd * texSize) + 0.5) / texSize;\r\n\t\t\t\t\r\n\t\t\t\tvec3 vof = texture2D(vof, crd).xyz;\r\n\t\t\t\tvof.z = 0.0;\r\n\t\t\t\tvec3 vel = texture2D(vel, crd).xyz;\r\n\t\t\t\tvec3 src = texture2D(psrc, crd).xyz;\r\n\t\t\t\tvec3 sol = texture2D(psol, crd).xyz;\r\n\t\t\t\tfloat room = texture2D(room, crd).x;\r\n\t\t\t\tvec4 target = texture2D(target, crd);\r\n\t\t\t\tvec4 lim = texture2D(lim, crd);\r\n\t\t\t\t// vec2 weight = texture2D(weight, crd).xy;\r\n\t\t\t\tvec4 pweight = texture2D(pweight, crd);\r\n\t\t\t\t\r\n\t\t\t\tint gx = int(floor(uv.x * 4.0));\r\n\t\t\t\tint gy = int(floor(uv.y * 4.0));\r\n\t\t\t\t\r\n\t\t\t\tvec3 col;\r\n\t\t\t\tif (gy == 3) {\r\n\t\t\t\t\tif (gx == 0) {\r\n\t\t\t\t\t\tcol = vof;\r\n\t\t\t\t\t} else if (gx == 1) {\r\n\t\t\t\t\t\tcol = vec3(vel.xy, 0) * 0.5 + 0.5;\r\n\t\t\t\t\t} else if (gx == 2) {\r\n\t\t\t\t\t\tcol = src.xxx * 0.5 + 0.5;\r\n\t\t\t\t\t} else if (gx == 3) {\r\n\t\t\t\t\t\tcol = src.yyy * 0.5 + 0.5;\r\n\t\t\t\t\t}\r\n\t\t\t\t} else if (gy == 2) {\r\n\t\t\t\t\tif (gx == 0) {\r\n\t\t\t\t\t\tcol = vec3(lim.xz * 0.25 + 0.5, 0);\r\n\t\t\t\t\t} else if (gx == 1) {\r\n\t\t\t\t\t\tcol = vec3(lim.yw * 0.25 + 0.5, 0);\r\n\t\t\t\t\t} else if (gx == 2) {\r\n\t\t\t\t\t\tcol = sol.xxx * 0.5 + 0.5;\r\n\t\t\t\t\t} else if (gx == 3) {\r\n\t\t\t\t\t\tcol = sol.yyy * 0.5 + 0.5;\r\n\t\t\t\t\t}\r\n\t\t\t\t} else if (gy == 1) {\r\n\t\t\t\t\tif (gx == 0) {\r\n\t\t\t\t\t\tcol = shouldBool(pweight.x);\r\n\t\t\t\t\t} else if (gx == 1) {\r\n\t\t\t\t\t\tcol = shouldBool(pweight.y);\r\n\t\t\t\t\t} else if (gx == 2) {\r\n\t\t\t\t\t\tcol = shouldBool(pweight.z);\r\n\t\t\t\t\t} else if (gx == 3) {\r\n\t\t\t\t\t\tcol = shouldBool(pweight.w);\r\n\t\t\t\t\t}\r\n\t\t\t\t} else if (gy == 0) {\r\n\t\t\t\t\tif (gx == 0) {\r\n\t\t\t\t\t\t// col = shouldBool(weight.x);\r\n\t\t\t\t\t} else if (gx == 1) {\r\n\t\t\t\t\t\t// col = shouldBool(weight.y);\r\n\t\t\t\t\t} else if (gx == 2) {\r\n\t\t\t\t\t\tcol = shouldBool(room);\r\n\t\t\t\t\t} else if (gx == 3) {\r\n\t\t\t\t\t\tcol = vec3(target.zw, 0);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tgl_FragColor = vec4(col, 1);\r\n\t\t\t}\r\n\t\t";
a.u=!1;a.map=new E;a.g.shaderSource(a.j,a.s);a.g.compileShader(a.j);a.g.getShaderParameter(a.j,35713)||window.alert(u.h(a.g.getShaderInfoLog(a.j)+"\nsource:\n"+a.s));a.g.shaderSource(a.h,a.o);a.g.compileShader(a.h);a.g.getShaderParameter(a.h,35713)||window.alert(u.h(a.g.getShaderInfoLog(a.h)+"\nsource:\n"+a.o));a.g.attachShader(a.l,a.j);a.g.attachShader(a.l,a.h);a.g.linkProgram(a.l);a.g.getProgramParameter(a.l,35714)?a.u=!0:g.console.log("link failed: "+a.g.getProgramInfoLog(a.l));this.h(this.Ya);
this.weight.D(function(c){c.rect(0,0,1,1)});this.h(this.Ra);this.ca.D(function(c){c.rect(0,0,1,1)});this.h(this.Wa);this.j.D(function(c){c.rect(0,0,1,1)});this.J.D(function(c){c.rect(0,0,1,1)});for(a=y.h;1<a;)this.h(this.X),this.X.O("vof",this.J.src),this.J.D(function(c){c.rect(0,0,1,1)}),a>>=1};y.prototype.h=function(a){this.v.Za=a;if(Object.prototype.hasOwnProperty.call(a.map.m,"vof"))var c=a.map.m.vof;else c=a.g.getUniformLocation(a.l,"vof"),a.map.m.vof=c;null!=c&&a.O("vof",this.j.src);Object.prototype.hasOwnProperty.call(a.map.m,
"vel")?c=a.map.m.vel:(c=a.g.getUniformLocation(a.l,"vel"),a.map.m.vel=c);null!=c&&a.O("vel",this.F.src);Object.prototype.hasOwnProperty.call(a.map.m,"weight")?c=a.map.m.weight:(c=a.g.getUniformLocation(a.l,"weight"),a.map.m.weight=c);null!=c&&a.O("weight",this.weight.src);Object.prototype.hasOwnProperty.call(a.map.m,"pweight")?c=a.map.m.pweight:(c=a.g.getUniformLocation(a.l,"pweight"),a.map.m.pweight=c);null!=c&&a.O("pweight",this.ka.src);Object.prototype.hasOwnProperty.call(a.map.m,"psrc")?c=a.map.m.psrc:
(c=a.g.getUniformLocation(a.l,"psrc"),a.map.m.psrc=c);null!=c&&a.O("psrc",this.ja.src);Object.prototype.hasOwnProperty.call(a.map.m,"psol")?c=a.map.m.psol:(c=a.g.getUniformLocation(a.l,"psol"),a.map.m.psol=c);null!=c&&a.O("psol",this.s.src);Object.prototype.hasOwnProperty.call(a.map.m,"flx")?c=a.map.m.flx:(c=a.g.getUniformLocation(a.l,"flx"),a.map.m.flx=c);null!=c&&a.O("flx",this.U.src);Object.prototype.hasOwnProperty.call(a.map.m,"room")?c=a.map.m.room:(c=a.g.getUniformLocation(a.l,"room"),a.map.m.room=
c);null!=c&&a.O("room",this.la.src);Object.prototype.hasOwnProperty.call(a.map.m,"lim")?c=a.map.m.lim:(c=a.g.getUniformLocation(a.l,"lim"),a.map.m.lim=c);null!=c&&a.O("lim",this.ca.src);Object.prototype.hasOwnProperty.call(a.map.m,"target")?c=a.map.m.target:(c=a.g.getUniformLocation(a.l,"target"),a.map.m.target=c);null!=c&&a.O("target",this.J.src);a.I("texSize",y.h);a.I("invTexSize",1/y.h);a.yb("resolution",this.canvas.width,this.canvas.height)};y.prototype.ya=function(){this.h(this.va);this.j.D(function(a){a.rect(0,
0,1,1)})};y.prototype.xa=function(){this.h(this.L);this.L.O("vof",this.j.qa);this.L.I("gScale",120>this.cb?this.cb/120:1);this.F.D(function(a){a.rect(0,0,1,1)})};y.prototype.Cb=function(){this.h(this.Ca);this.ja.D(function(a){a.rect(0,0,1,1)});this.h(this.Da);this.ka.D(function(a){a.rect(0,0,1,1)});this.h(this.$a);this.s.D(function(a){a.rect(0,0,1,1)});this.h(this.o);this.o.I("parity",0);this.s.D(function(a){a.rect(0,0,1,1)});this.h(this.o);this.o.I("parity",1);this.s.D(function(a){a.rect(0,0,1,1)});
this.h(this.o);this.o.I("parity",0);this.s.D(function(a){a.rect(0,0,1,1)});this.h(this.o);this.o.I("parity",1);this.s.D(function(a){a.rect(0,0,1,1)})};y.prototype.Na=function(){this.h(this.Aa);this.F.D(function(a){a.rect(0,0,1,1)})};y.prototype.Oa=function(){this.h(this.Ba);this.U.D(function(c){c.rect(0,0,1,1)});this.h(this.Ma);this.U.D(function(c){c.rect(0,0,1,1)});this.h(this.za);this.j.D(function(c){c.rect(0,0,1,1)});for(var a=y.h;1<a;)this.h(this.X),this.j.D(function(c){c.rect(0,0,1,1)}),a>>=
1;this.h(this.Pa);this.j.D(function(c){c.rect(0,0,1,1)})};y.prototype.view=function(){this.h(this.Eb);this.v.nb();var a=this.v;if(1!=a.W)throw Error("begin scene before clear scene");a.g.clearColor(0,0,0,1);a.g.clearDepth(1);a.g.clear(16640);this.v.A=this.j.src;a=this.canvas.width/this.canvas.height;this.v.Xa(5);var c=this.v;c.Ha=0;c.Ia=0;c.Ja=-1;c=this.v;var b=0,d=0;if(1!=c.G&&null==c.A)throw Error("set texture before calling texCoord when texture mode is not Normal");switch(c.G){case 0:b*=c.A.ha,
d*=c.A.ia}c.Z=b;c.$=1-d;this.v.M(0,0,0);c=this.v;b=0;d=1;if(1!=c.G&&null==c.A)throw Error("set texture before calling texCoord when texture mode is not Normal");switch(c.G){case 0:b*=c.A.ha,d*=c.A.ia}c.Z=b;c.$=1-d;this.v.M(0,1,0);c=this.v;b=a;d=0;if(1!=c.G&&null==c.A)throw Error("set texture before calling texCoord when texture mode is not Normal");switch(c.G){case 0:b=a*c.A.ha,d*=c.A.ia}c.Z=b;c.$=1-d;this.v.M(1,0,0);c=this.v;b=a;d=1;if(1!=c.G&&null==c.A)throw Error("set texture before calling texCoord when texture mode is not Normal");
switch(c.G){case 0:b=a*c.A.ha,d*=c.A.ia}c.Z=b;c.$=1-d;this.v.M(1,1,0);this.v.ab();a=this.v;if(1!=a.W)throw Error("scene already ended");a.W=!1;a.g.flush()};y.prototype.update=function(){this.xa();this.ya();this.Cb();this.Na();this.Oa()};y.prototype.oa=function(){this.view()};y.j=function(){new y(window.document.getElementById("canvas"),null,!1)};y.B=!0;ya.h=function(a,c){c=a.indexOf(c);-1!=c&&a.splice(c,1)};ya.B=!0;Math.B=!0;u.h=function(a){return ea.h(a,"")};u.B=!0;Ea(H,Error);H.h=function(a){return a instanceof
H?a:a instanceof Error?new H(a.message,null,a):new oa(a,null,a)};H.j=function(a){return a instanceof H?a.h:a instanceof Error?a:new oa(a)};H.B=!0;Ea(oa,H);oa.B=!0;E.B=!0;ea.h=function(a,c){if(null==a)return"null";if(5<=c.length)return"<...>";var b=typeof a;"function"==b&&(a.B||a.lb)&&(b="object");switch(b){case "function":return"<function>";case "object":if(a.pa){var d=pa[a.pa].Ea[a.na];b=d.wa;if(d.mb){c+="\t";var h=[],e=0;for(d=d.mb;e<d.length;){var f=d[e];e+=1;h.push(ea.h(a[f],c))}return b+"("+
h.join(",")+")"}return b}if(a instanceof Array){b="[";c+="\t";h=0;for(e=a.length;h<e;)d=h++,b+=(0<d?",":"")+ea.h(a[d],c);return b+"]"}try{h=a.toString}catch(n){return"???"}if(null!=h&&h!=Object.toString&&"function"==typeof h&&(b=a.toString(),"[object Object]"!=b))return b;b="{\n";c+="\t";h=null!=a.hasOwnProperty;e=null;for(e in a)h&&!a.hasOwnProperty(e)||"prototype"==e||"__class__"==e||"__super__"==e||"__interfaces__"==e||"__properties__"==e||(2!=b.length&&(b+=", \n"),b+=c+e+" : "+ea.h(a[e],c));c=
c.substring(1);return b+("\n"+c+"}");case "string":return a;default:return String(a)}};ea.B=!0;xa.h=function(a){var c={premultipliedAlpha:!1},b=a.getContext("webgl",c);if(null!=b)return b;a=a.getContext("experimental-webgl",c);return null!=a?a:null};xa.B=!0;var ra=pa["pot.core.FrameRate"]={lb:!0,Ea:null,Ab:{wa:"Auto",na:0,pa:"pot.core.FrameRate",toString:la},kb:(qa=function(a){return{na:1,Fb:a,pa:"pot.core.FrameRate",toString:la}},qa.wa="Fixed",qa.mb=["fps"],qa)};ra.Ea=[ra.Ab,ra.kb];da.prototype.frameRate=
function(a){switch(a.na){case 0:this.j.F(60);this.j.o=!0;break;case 1:this.j.F(a.Fb),this.j.o=!1}};da.prototype.C=function(){var a=this;this.s=new ResizeObserver(function(){a.o()});this.s.observe(this.canvas);this.s.observe(window.document.documentElement)};da.prototype.o=function(){var a=this.canvas.getBoundingClientRect(),c=a.width;a=a.height;var b=window.devicePixelRatio;if(this.width!=c||this.height!=a||this.fa!=b)this.width=c,this.height=a,this.fa=b,this.canvas.width=this.width*this.fa+.5|0,
this.canvas.height=this.height*this.fa+.5|0};da.prototype.start=function(){this.j.start()};da.prototype.update=function(){this.h.cb++;null!=this.h.input&&this.h.input.update();this.h.update()};da.prototype.oa=function(){this.h.oa()};da.B=!0;K.prototype.Qa=function(){this.g.getExtension("OES_texture_float");this.g.getExtension("OES_texture_float_linear");this.g.getExtension("OES_texture_half_float");this.g.getExtension("OES_texture_half_float_linear");this.g.getExtension("WEBGL_color_buffer_float");
this.g.getExtension("OES_element_index_uint");this.g.disable(2929);this.g.enable(3042);this.g.frontFace(2305);this.g.cullFace(1029);this.g.disable(2884);this.g.blendFuncSeparate(770,771,1,1);this.g.pixelStorei(37440,!0)};K.prototype.Oa=function(){this.g.disable(2929);this.g.frontFace(2305);this.g.cullFace(1029);this.g.disable(2884);this.za=!1;if(null==this.N){var a=this.canvas.width;var c=this.canvas.height}else a=this.N.width,c=this.N.height;this.g.viewport(0,0,a,c);this.A=null};K.prototype.Ra=function(){this.va=
new J;this.h=new J;this.ka=new J;this.F=new J;this.la=new J;this.Ca=new J};K.prototype.Sa=function(){var a=this.X=new C(this.g);a.s="\n\t\tattribute vec4 position;\n\t\tattribute vec4 color;\n\t\tattribute vec3 normal;\n\t\tattribute vec2 texCoord;\n\n\t\tuniform mat4 transform;\n\t\tuniform mat4 modelview;\n\t\tuniform mat3 normalMatrix;\n\n\t\tvarying vec4 vColor;\n\t\tvarying vec3 vPosition;\n\t\tvarying vec3 vNormal;\n\t\tvarying vec2 vTexCoord;\n\n\t\tvoid main() {\n\t\t\tgl_Position = transform * position;\n\n\t\t\tvColor = color;\n\t\t\tvPosition = (modelview * position).xyz;\n\t\t\tvNormal = normalMatrix * normal;\n\t\t\tvTexCoord = texCoord;\n\t\t}\n\t";
a.u=!1;a=this.X;a.o="\n\t\tprecision highp float;\n\t\tvarying vec4 vColor;\n\t\tvarying vec3 vPosition;\n\t\tvarying vec3 vNormal;\n\t\tvarying vec2 vTexCoord;\n\t\tuniform float ambient;\n\t\tuniform float diffuse;\n\t\tuniform float specular;\n\t\tuniform float shininess;\n\t\tuniform float emission;\n\t\tuniform int numLights;\n\t\tuniform vec4 lightPositions[8];\n\t\tuniform vec3 lightColors[8];\n\t\tuniform vec3 lightNormals[8];\n\n\t\tvec3 safeNormalize(vec3 v) {\n\t\t\treturn dot(v, v) > 0.0 ? normalize(v) : vec3(0);\n\t\t}\n\n\t\tvoid main() {\n\t\t\tif (numLights == 0) {\n\t\t\t\tgl_FragColor = vColor;\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tvec3 eye = safeNormalize(vPosition);\n\t\t\tvec3 n = safeNormalize(vNormal);\n\t\t\t\n\t\t\tvec3 color = vColor.xyz;\n\t\t\tvec3 ambientTotal = vec3(0);\n\t\t\tvec3 diffuseTotal = vec3(0);\n\t\t\tvec3 specularTotal = vec3(0);\n\t\t\tvec3 emissionTotal = color * emission;\n\n\t\t\tif (!gl_FrontFacing) n = -n;\n\n\t\t\tfor (int i = 0; i < 8; i++) {\n\t\t\t\tif (i == numLights) break;\n\t\t\t\tvec4 lp = lightPositions[i];\n\t\t\t\tvec3 lc = lightColors[i];\n\t\t\t\tvec3 ln = lightNormals[i];\n\t\t\t\tbool amb = lp.w == 0.0 && dot(ln, ln) == 0.0;\n\t\t\t\tbool dir = lp.w == 0.0;\n\t\t\t\tif (amb) {\n\t\t\t\t\tambientTotal += lc * color * ambient;\n\t\t\t\t} else {\n\t\t\t\t\tif (!dir) {\n\t\t\t\t\t\tln = safeNormalize(vPosition - lp.xyz);\n\t\t\t\t\t\t// TODO: spot light\n\t\t\t\t\t}\n\t\t\t\t\tfloat ldot = -dot(ln, n);\n\t\t\t\t\tif (ldot < 0.0) ldot = 0.0;\n\t\t\t\t\tdiffuseTotal += lc * color * ldot * diffuse;\n\t\t\t\t\tif (ldot > 0.0) {\n\t\t\t\t\t\tvec3 reflEye = eye - 2.0 * n * dot(eye, n);\n\t\t\t\t\t\tfloat rdot = -dot(reflEye, ln);\n\t\t\t\t\t\tif (rdot < 0.0) rdot = 0.0;\n\t\t\t\t\t\tspecularTotal += lc * pow(rdot, shininess) * specular;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\tgl_FragColor = vec4(ambientTotal + diffuseTotal + specularTotal + emissionTotal, vColor.w);\n\t\t}\n\t";
a.u=!1;a=this.X;a.map=new E;a.g.shaderSource(a.j,a.s);a.g.compileShader(a.j);a.g.getShaderParameter(a.j,35713)||window.alert(u.h(a.g.getShaderInfoLog(a.j)+"\nsource:\n"+a.s));a.g.shaderSource(a.h,a.o);a.g.compileShader(a.h);a.g.getShaderParameter(a.h,35713)||window.alert(u.h(a.g.getShaderInfoLog(a.h)+"\nsource:\n"+a.o));a.g.attachShader(a.l,a.j);a.g.attachShader(a.l,a.h);a.g.linkProgram(a.l);a.g.getProgramParameter(a.l,35714)?a.u=!0:g.console.log("link failed: "+a.g.getProgramInfoLog(a.l));a=this.ca=
new C(this.g);a.s="\n\t\tattribute vec4 position;\n\t\tattribute vec4 color;\n\t\tattribute vec3 normal;\n\t\tattribute vec2 texCoord;\n\n\t\tuniform mat4 transform;\n\t\tuniform mat4 modelview;\n\t\tuniform mat3 normalMatrix;\n\n\t\tvarying vec4 vColor;\n\t\tvarying vec3 vPosition;\n\t\tvarying vec3 vNormal;\n\t\tvarying vec2 vTexCoord;\n\n\t\tvoid main() {\n\t\t\tgl_Position = transform * position;\n\n\t\t\tvColor = color;\n\t\t\tvPosition = (modelview * position).xyz;\n\t\t\tvNormal = normalMatrix * normal;\n\t\t\tvTexCoord = texCoord;\n\t\t}\n\t";
a.u=!1;a=this.ca;a.o="\n\t\tprecision highp float;\n\t\tuniform sampler2D texture;\n\t\tvarying vec4 vColor;\n\t\tvarying vec3 vPosition;\n\t\tvarying vec3 vNormal;\n\t\tvarying vec2 vTexCoord;\n\t\tuniform float ambient;\n\t\tuniform float diffuse;\n\t\tuniform float specular;\n\t\tuniform float shininess;\n\t\tuniform float emission;\n\t\tuniform int numLights;\n\t\tuniform vec4 lightPositions[8];\n\t\tuniform vec3 lightColors[8];\n\t\tuniform vec3 lightNormals[8];\n\n\t\tvec3 safeNormalize(vec3 v) {\n\t\t\treturn dot(v, v) > 0.0 ? normalize(v) : vec3(0);\n\t\t}\n\n\t\tvoid main() {\n\t\t\tvec4 texMulColor = texture2D(texture, vTexCoord) * vColor;\n\t\t\tif (numLights == 0) {\n\t\t\t\tgl_FragColor = texMulColor;\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tvec3 eye = safeNormalize(vPosition);\n\t\t\tvec3 n = safeNormalize(vNormal);\n\t\t\tvec3 color = texMulColor.xyz;\n\t\t\tvec3 ambientTotal = vec3(0);\n\t\t\tvec3 diffuseTotal = vec3(0);\n\t\t\tvec3 specularTotal = vec3(0);\n\t\t\tvec3 emissionTotal = color * emission;\n\n\t\t\tif (!gl_FrontFacing) n = -n;\n\n\t\t\tfor (int i = 0; i < 8; i++) {\n\t\t\t\tif (i == numLights) break;\n\t\t\t\tvec4 lp = lightPositions[i];\n\t\t\t\tvec3 lc = lightColors[i];\n\t\t\t\tvec3 ln = lightNormals[i];\n\t\t\t\tbool amb = lp.w == 0.0 && dot(ln, ln) == 0.0;\n\t\t\t\tbool dir = lp.w == 0.0;\n\t\t\t\tif (amb) {\n\t\t\t\t\tambientTotal += lc * color * ambient;\n\t\t\t\t} else {\n\t\t\t\t\tif (!dir) {\n\t\t\t\t\t\tln = safeNormalize(vPosition - lp.xyz);\n\t\t\t\t\t\t// TODO: spot light\n\t\t\t\t\t}\n\t\t\t\t\tfloat ldot = -dot(ln, n);\n\t\t\t\t\tif (ldot < 0.0) ldot = 0.0;\n\t\t\t\t\tdiffuseTotal += lc * color * ldot * diffuse;\n\t\t\t\t\tif (ldot > 0.0) {\n\t\t\t\t\t\tvec3 reflEye = eye - 2.0 * n * dot(eye, n);\n\t\t\t\t\t\tfloat rdot = -dot(reflEye, ln);\n\t\t\t\t\t\tif (rdot < 0.0) rdot = 0.0;\n\t\t\t\t\t\tspecularTotal += lc * pow(rdot, shininess) * specular;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\tgl_FragColor = vec4(ambientTotal + diffuseTotal + specularTotal + emissionTotal, texMulColor.w);\n\t\t}\n\t";
a.u=!1;a=this.ca;a.map=new E;a.g.shaderSource(a.j,a.s);a.g.compileShader(a.j);a.g.getShaderParameter(a.j,35713)||window.alert(u.h(a.g.getShaderInfoLog(a.j)+"\nsource:\n"+a.s));a.g.shaderSource(a.h,a.o);a.g.compileShader(a.h);a.g.getShaderParameter(a.h,35713)||window.alert(u.h(a.g.getShaderInfoLog(a.h)+"\nsource:\n"+a.o));a.g.attachShader(a.l,a.j);a.g.attachShader(a.l,a.h);a.g.linkProgram(a.l);a.g.getProgramParameter(a.l,35714)?a.u=!0:g.console.log("link failed: "+a.g.getProgramInfoLog(a.l));this.Za=
null};K.prototype.Pa=function(){this.C=new q(this.g,"position",3);this.o=new q(this.g,"color",4);this.s=new q(this.g,"normal",3);this.U=new q(this.g,"texCoord",2);this.ja=new Fa(this.g)};K.prototype.Ma=function(){return null!=this.Za?this.Za:null!=this.A?this.ca:this.X};K.prototype.nb=function(){if(0!=this.W)throw Error("scene already begun");this.W=!0;this.va.Hb();this.J=0;this.A=null;this.P=this.R=this.S=this.T=1;this.$=this.Z=this.Ja=this.Ia=this.Ha=0;this.La=this.Ta=1;this.Ya=0;this.Wa=10;this.Va=
0;this.za||(this.Aa=.5*this.ma,this.Ba=.5*this.L,this.Na=-this.L/(2*Math.tan(.5*this.ua)),this.h.Ib(this.Aa,this.Ba,this.Na,this.Aa,this.Ba))};K.prototype.Xa=function(a){if(1!=this.W)throw Error("begin scene before begin shape");this.$a=a;this.Da=0;this.C.length=0;this.o.length=0;this.s.length=0;this.U.length=0;this.ja.length=0};K.prototype.rect=function(a,c,b,d){var h=this.G;this.G=1;this.Xa(5);this.Ia=this.Ha=0;this.Ja=-1;var e=0,f=0;if(1!=this.G&&null==this.A)throw Error("set texture before calling texCoord when texture mode is not Normal");
switch(this.G){case 0:e*=this.A.ha,f*=this.A.ia}this.Z=e;this.$=1-f;this.M(a,c,0);e=0;f=1;if(1!=this.G&&null==this.A)throw Error("set texture before calling texCoord when texture mode is not Normal");switch(this.G){case 0:e*=this.A.ha,f*=this.A.ia}this.Z=e;this.$=1-f;this.M(a,c+d,0);e=1;f=0;if(1!=this.G&&null==this.A)throw Error("set texture before calling texCoord when texture mode is not Normal");switch(this.G){case 0:e*=this.A.ha,f*=this.A.ia}this.Z=e;this.$=1-f;this.M(a+b,c,0);f=e=1;if(1!=this.G&&
null==this.A)throw Error("set texture before calling texCoord when texture mode is not Normal");switch(this.G){case 0:e*=this.A.ha,f*=this.A.ia}this.Z=e;this.$=1-f;this.M(a+b,c+d,0);this.ab();this.G=h};K.prototype.M=function(a,c,b){null==b&&(b=0);var d=this.ja,h=this.Da++;if(d.length==d.i.length){for(var e=d.i.length,f=new Int32Array(e<<1),n=0;n<e;){var r=n++;f[r]=d.i[r]}d.i=f}d.i[d.length++]=h;d=this.C;if(d.length==d.i.length){h=d.i.length;e=new Float32Array(h<<1);for(f=0;f<h;)n=f++,e[n]=d.i[n];
d.i=e}d.i[d.length++]=a;a=this.C;if(a.length==a.i.length){d=a.i.length;h=new Float32Array(d<<1);for(e=0;e<d;)f=e++,h[f]=a.i[f];a.i=h}a.i[a.length++]=c;c=this.C;if(c.length==c.i.length){a=c.i.length;d=new Float32Array(a<<1);for(h=0;h<a;)e=h++,d[e]=c.i[e];c.i=d}c.i[c.length++]=b;b=this.o;c=this.T;if(b.length==b.i.length){a=b.i.length;d=new Float32Array(a<<1);for(h=0;h<a;)e=h++,d[e]=b.i[e];b.i=d}b.i[b.length++]=c;b=this.o;c=this.S;if(b.length==b.i.length){a=b.i.length;d=new Float32Array(a<<1);for(h=
0;h<a;)e=h++,d[e]=b.i[e];b.i=d}b.i[b.length++]=c;b=this.o;c=this.R;if(b.length==b.i.length){a=b.i.length;d=new Float32Array(a<<1);for(h=0;h<a;)e=h++,d[e]=b.i[e];b.i=d}b.i[b.length++]=c;b=this.o;c=this.P;if(b.length==b.i.length){a=b.i.length;d=new Float32Array(a<<1);for(h=0;h<a;)e=h++,d[e]=b.i[e];b.i=d}b.i[b.length++]=c;b=this.s;c=this.Ha;if(b.length==b.i.length){a=b.i.length;d=new Float32Array(a<<1);for(h=0;h<a;)e=h++,d[e]=b.i[e];b.i=d}b.i[b.length++]=c;b=this.s;c=this.Ia;if(b.length==b.i.length){a=
b.i.length;d=new Float32Array(a<<1);for(h=0;h<a;)e=h++,d[e]=b.i[e];b.i=d}b.i[b.length++]=c;b=this.s;c=this.Ja;if(b.length==b.i.length){a=b.i.length;d=new Float32Array(a<<1);for(h=0;h<a;)e=h++,d[e]=b.i[e];b.i=d}b.i[b.length++]=c;b=this.U;c=this.Z;if(b.length==b.i.length){a=b.i.length;d=new Float32Array(a<<1);for(h=0;h<a;)e=h++,d[e]=b.i[e];b.i=d}b.i[b.length++]=c;b=this.U;c=this.$;if(b.length==b.i.length){a=b.i.length;d=new Float32Array(a<<1);for(h=0;h<a;)e=h++,d[e]=b.i[e];b.i=d}b.i[b.length++]=c};
K.prototype.ab=function(){var a=this.Ma(),c=a.l;this.ka.pb(this.h,this.va);this.F.inverse(this.ka);this.F.Kb(this.F);if(Object.prototype.hasOwnProperty.call(a.map.m,"model"))var b=a.map.m.model;else b=a.g.getUniformLocation(a.l,"model"),a.map.m.model=b;null!=b&&a.ta("model",this.va.i);Object.prototype.hasOwnProperty.call(a.map.m,"view")?b=a.map.m.view:(b=a.g.getUniformLocation(a.l,"view"),a.map.m.view=b);null!=b&&a.ta("view",this.h.i);Object.prototype.hasOwnProperty.call(a.map.m,"projection")?b=a.map.m.projection:
(b=a.g.getUniformLocation(a.l,"projection"),a.map.m.projection=b);null!=b&&a.ta("projection",this.la.i);Object.prototype.hasOwnProperty.call(a.map.m,"transform")?b=a.map.m.transform:(b=a.g.getUniformLocation(a.l,"transform"),a.map.m.transform=b);null!=b&&(this.Ca.pb(this.la,this.ka),a.ta("transform",this.Ca.i));Object.prototype.hasOwnProperty.call(a.map.m,"modelview")?b=a.map.m.modelview:(b=a.g.getUniformLocation(a.l,"modelview"),a.map.m.modelview=b);null!=b&&a.ta("modelview",this.ka.i);Object.prototype.hasOwnProperty.call(a.map.m,
"normalMatrix")?b=a.map.m.normalMatrix:(b=a.g.getUniformLocation(a.l,"normalMatrix"),a.map.m.normalMatrix=b);null!=b&&(this.F.Jb(),a.ta("normalMatrix",this.F.Y));null!=this.A&&(a.O("texture",this.A),Object.prototype.hasOwnProperty.call(a.map.m,"texResolution")?b=a.map.m.texResolution:(b=a.g.getUniformLocation(a.l,"texResolution"),a.map.m.texResolution=b),null!=b&&a.I("texResolution",this.A.width,this.A.height));Object.prototype.hasOwnProperty.call(a.map.m,"ambient")?b=a.map.m.ambient:(b=a.g.getUniformLocation(a.l,
"ambient"),a.map.m.ambient=b);null!=b&&a.I("ambient",this.Ta);Object.prototype.hasOwnProperty.call(a.map.m,"diffuse")?b=a.map.m.diffuse:(b=a.g.getUniformLocation(a.l,"diffuse"),a.map.m.diffuse=b);null!=b&&a.I("diffuse",this.La);Object.prototype.hasOwnProperty.call(a.map.m,"specular")?b=a.map.m.specular:(b=a.g.getUniformLocation(a.l,"specular"),a.map.m.specular=b);null!=b&&a.I("specular",this.Ya);Object.prototype.hasOwnProperty.call(a.map.m,"shininess")?b=a.map.m.shininess:(b=a.g.getUniformLocation(a.l,
"shininess"),a.map.m.shininess=b);null!=b&&a.I("shininess",this.Wa);Object.prototype.hasOwnProperty.call(a.map.m,"emission")?b=a.map.m.emission:(b=a.g.getUniformLocation(a.l,"emission"),a.map.m.emission=b);null!=b&&a.I("emission",this.Va);Object.prototype.hasOwnProperty.call(a.map.m,"numLights")?b=a.map.m.numLights:(b=a.g.getUniformLocation(a.l,"numLights"),a.map.m.numLights=b);null!=b&&a.yb("numLights",this.J);Object.prototype.hasOwnProperty.call(a.map.m,"lightPositions")?b=a.map.m.lightPositions:
(b=a.g.getUniformLocation(a.l,"lightPositions"),a.map.m.lightPositions=b);if(null!=b){b=0;for(var d=this.J;b<d;){var h=b++,e=this.j[h];a.I("lightPositions["+h+"]",e.tb*this.h.i[0]+e.ub*this.h.i[4]+e.vb*this.h.i[8]+this.h.i[12],e.tb*this.h.i[1]+e.ub*this.h.i[5]+e.vb*this.h.i[9]+this.h.i[13],e.tb*this.h.i[2]+e.ub*this.h.i[6]+e.vb*this.h.i[10]+this.h.i[14],e.Mb)}}Object.prototype.hasOwnProperty.call(a.map.m,"lightNormals")?b=a.map.m.lightNormals:(b=a.g.getUniformLocation(a.l,"lightNormals"),a.map.m.lightNormals=
b);if(null!=b)for(b=0,d=this.J;b<d;)h=b++,e=this.j[h],a.I("lightNormals["+h+"]",e.qb*this.h.i[0]+e.rb*this.h.i[4]+e.sb*this.h.i[8],e.qb*this.h.i[1]+e.rb*this.h.i[5]+e.sb*this.h.i[9],e.qb*this.h.i[2]+e.rb*this.h.i[6]+e.sb*this.h.i[10]);Object.prototype.hasOwnProperty.call(a.map.m,"lightColors")?b=a.map.m.lightColors:(b=a.g.getUniformLocation(a.l,"lightColors"),a.map.m.lightColors=b);if(null!=b)for(b=0,d=this.J;b<d;)h=b++,e=this.j[h],a.I("lightColors["+h+"]",e.r,e.v,e.b);b=this.ja;b.g.bindBuffer(34963,
b.buffer);b.g.bufferData(34963,new Int32Array(b.i.buffer,0,b.length),35048);b.g.bindBuffer(34963,null);b=this.C;b.g.bindBuffer(34962,b.buffer);b.g.bufferData(34962,new Float32Array(b.i.buffer,0,b.length),35048);b.g.bindBuffer(34962,null);b=this.o;b.g.bindBuffer(34962,b.buffer);b.g.bufferData(34962,new Float32Array(b.i.buffer,0,b.length),35048);b.g.bindBuffer(34962,null);b=this.s;b.g.bindBuffer(34962,b.buffer);b.g.bufferData(34962,new Float32Array(b.i.buffer,0,b.length),35048);b.g.bindBuffer(34962,
null);b=this.U;b.g.bindBuffer(34962,b.buffer);b.g.bufferData(34962,new Float32Array(b.i.buffer,0,b.length),35048);b.g.bindBuffer(34962,null);b=this.C;d=b.g.getAttribLocation(c,b.name);-1!=d&&(b.g.bindBuffer(34962,b.buffer),b.g.enableVertexAttribArray(d),b.g.vertexAttribPointer(d,b.size,5126,!1,0,0),b.g.bindBuffer(34962,null));b=this.o;d=b.g.getAttribLocation(c,b.name);-1!=d&&(b.g.bindBuffer(34962,b.buffer),b.g.enableVertexAttribArray(d),b.g.vertexAttribPointer(d,b.size,5126,!1,0,0),b.g.bindBuffer(34962,
null));b=this.s;d=b.g.getAttribLocation(c,b.name);-1!=d&&(b.g.bindBuffer(34962,b.buffer),b.g.enableVertexAttribArray(d),b.g.vertexAttribPointer(d,b.size,5126,!1,0,0),b.g.bindBuffer(34962,null));b=this.U;c=b.g.getAttribLocation(c,b.name);-1!=c&&(b.g.bindBuffer(34962,b.buffer),b.g.enableVertexAttribArray(c),b.g.vertexAttribPointer(c,b.size,5126,!1,0,0),b.g.bindBuffer(34962,null));if(!a.u)throw Error("shader is not compiled");a.g.useProgram(a.l);c=0;b=Object.keys(a.ba.m);d=b.length;for(h=0;h<d;){e=b[h++];
if(Object.prototype.hasOwnProperty.call(a.map.m,e))var f=a.map.m[e];else f=a.g.getUniformLocation(a.l,e),a.map.m[e]=f;if(null!=f){f=a.ba.m[e];if(Object.prototype.hasOwnProperty.call(a.map.m,e))e=a.map.m[e];else{var n=a.g.getUniformLocation(a.l,e);e=a.map.m[e]=n}switch(f.type){case 0:a.g.uniform1i(e,f.Ga);break;case 1:a.g.uniform2i(e,f.Ga,f.fb);break;case 2:a.g.uniform3i(e,f.Ga,f.fb,f.Gb);break;case 3:a.g.uniform4i(e,f.Ga,f.fb,f.Gb,f.Lb);break;case 4:a.g.uniform1f(e,f.Fa);break;case 5:a.g.uniform2f(e,
f.Fa,f.bb);break;case 6:a.g.uniform3f(e,f.Fa,f.bb,f.ob);break;case 7:a.g.uniform4f(e,f.Fa,f.bb,f.ob,f.Db);break;case 8:a.g.uniformMatrix2fv(e,!1,f.ra);break;case 9:a.g.uniformMatrix3fv(e,!1,f.V);break;case 10:a.g.uniformMatrix4fv(e,!1,f.H);break;case 11:a.g.activeTexture(33984+c),a.g.bindTexture(3553,null==f.zb?null:f.zb.aa),a.g.uniform1i(e,c),++c}}}a.g.activeTexture(33984);a=this.ja;c=this.$a;a.g.bindBuffer(34963,a.buffer);a.g.drawElements(c,a.length,5125,0);a.g.bindBuffer(34963,null)};K.B=!0;P.B=
!0;J.prototype.Hb=function(){this.i[0]=1;this.i[1]=0;this.i[2]=0;this.i[3]=0;this.i[4]=0;this.i[5]=1;this.i[6]=0;this.i[7]=0;this.i[8]=0;this.i[9]=0;this.i[10]=1;this.i[11]=0;this.i[12]=0;this.i[13]=0;this.i[14]=0;this.i[15]=1};J.prototype.Ib=function(a,c,b,d,h){d=a-d;h=c-h;var e=b-0,f=1/Math.sqrt(d*d+h*h+e*e);d*=f;h*=f;e*=f;var n=-1*e-0*h,r=0*d-0*e,v=0*h- -1*d;f=1/Math.sqrt(n*n+r*r+v*v);n*=f;r*=f;v*=f;f=h*v-e*r;var z=e*n-d*v,B=d*r-h*n;this.i[0]=n;this.i[1]=f;this.i[2]=d;this.i[3]=0;this.i[4]=r;this.i[5]=
z;this.i[6]=h;this.i[7]=0;this.i[8]=v;this.i[9]=B;this.i[10]=e;this.i[11]=0;this.i[12]=-(n*a+r*c+v*b);this.i[13]=-(f*a+z*c+B*b);this.i[14]=-(d*a+h*c+e*b);this.i[15]=1};J.prototype.perspective=function(a,c,b,d){a=1/Math.tan(.5*a);d/=b-d;this.i[0]=a/c;this.i[1]=0;this.i[2]=0;this.i[3]=0;this.i[4]=0;this.i[5]=a;this.i[6]=0;this.i[7]=0;this.i[8]=0;this.i[9]=0;this.i[10]=d;this.i[11]=-1;this.i[12]=0;this.i[13]=0;this.i[14]=b*d;this.i[15]=0};J.prototype.pb=function(a,c){var b=a.i[0],d=a.i[1],h=a.i[2],e=
a.i[3],f=a.i[4],n=a.i[5],r=a.i[6],v=a.i[7],z=a.i[8],B=a.i[9],G=a.i[10],F=a.i[11],I=a.i[12],L=a.i[13],Q=a.i[14];a=a.i[15];var R=c.i[0],S=c.i[1],T=c.i[2],U=c.i[3],V=c.i[4],W=c.i[5],X=c.i[6],Y=c.i[7],Z=c.i[8],aa=c.i[9],ba=c.i[10],fa=c.i[11],ha=c.i[12],sa=c.i[13],ta=c.i[14];c=c.i[15];this.i[0]=b*R+f*S+z*T+I*U;this.i[1]=d*R+n*S+B*T+L*U;this.i[2]=h*R+r*S+G*T+Q*U;this.i[3]=e*R+v*S+F*T+a*U;this.i[4]=b*V+f*W+z*X+I*Y;this.i[5]=d*V+n*W+B*X+L*Y;this.i[6]=h*V+r*W+G*X+Q*Y;this.i[7]=e*V+v*W+F*X+a*Y;this.i[8]=b*
Z+f*aa+z*ba+I*fa;this.i[9]=d*Z+n*aa+B*ba+L*fa;this.i[10]=h*Z+r*aa+G*ba+Q*fa;this.i[11]=e*Z+v*aa+F*ba+a*fa;this.i[12]=b*ha+f*sa+z*ta+I*c;this.i[13]=d*ha+n*sa+B*ta+L*c;this.i[14]=h*ha+r*sa+G*ta+Q*c;this.i[15]=e*ha+v*sa+F*ta+a*c};J.prototype.Kb=function(a){var c=a.i[1],b=a.i[2],d=a.i[3],h=a.i[4],e=a.i[5],f=a.i[6],n=a.i[7],r=a.i[8],v=a.i[9],z=a.i[10],B=a.i[11],G=a.i[12],F=a.i[13],I=a.i[14],L=a.i[15];this.i[0]=a.i[0];this.i[1]=h;this.i[2]=r;this.i[3]=G;this.i[4]=c;this.i[5]=e;this.i[6]=v;this.i[7]=F;this.i[8]=
b;this.i[9]=f;this.i[10]=z;this.i[11]=I;this.i[12]=d;this.i[13]=n;this.i[14]=B;this.i[15]=L};J.prototype.inverse=function(a){var c=a.i[0],b=a.i[1],d=a.i[2],h=a.i[3],e=a.i[4],f=a.i[5],n=a.i[6],r=a.i[7],v=a.i[8],z=a.i[9],B=a.i[10],G=a.i[11],F=a.i[12],I=a.i[13],L=a.i[14];a=a.i[15];var Q=c*f-e*b,R=c*z-v*b,S=c*I-F*b,T=e*z-v*f,U=e*I-F*f,V=v*I-F*z,W=d*r-n*h,X=d*G-B*h,Y=d*a-L*h,Z=n*G-B*r,aa=n*a-L*r,ba=B*a-L*G,fa=f*ba-z*aa+I*Z,ha=b*ba-z*Y+I*X;I=b*aa-f*Y+I*W;b=b*Z-f*X+z*W;f=c*fa-e*ha+v*I-F*b;0!=f&&(f=1/f);
this.i[0]=fa*f;this.i[1]=-ha*f;this.i[2]=I*f;this.i[3]=-b*f;this.i[4]=-(e*ba-v*aa+F*Z)*f;this.i[5]=(c*ba-v*Y+F*X)*f;this.i[6]=-(c*aa-e*Y+F*W)*f;this.i[7]=(c*Z-e*X+v*W)*f;this.i[8]=(r*V-G*U+a*T)*f;this.i[9]=-(h*V-G*S+a*R)*f;this.i[10]=(h*U-r*S+a*Q)*f;this.i[11]=-(h*T-r*R+G*Q)*f;this.i[12]=-(n*V-B*U+L*T)*f;this.i[13]=(d*V-B*S+L*R)*f;this.i[14]=-(d*U-n*S+L*Q)*f;this.i[15]=(d*T-n*R+B*Q)*f};J.prototype.Jb=function(){this.Y[0]=this.i[0];this.Y[1]=this.i[1];this.Y[2]=this.i[2];this.Y[3]=this.i[4];this.Y[4]=
this.i[5];this.Y[5]=this.i[6];this.Y[6]=this.i[8];this.Y[7]=this.i[9];this.Y[8]=this.i[10]};J.B=!0;Fa.B=!0;C.prototype.yb=function(a,c,b){var d=this.ba.m[a];null==d&&(d=new M);d.type=0;d.Ga=c;null!=b&&(d.type=1,d.fb=b);this.ba.m[a]=d};C.prototype.I=function(a,c,b,d,h){var e=this.ba.m[a];null==e&&(e=new M);e.type=4;e.Fa=c;null!=b&&(e.type=5,e.bb=b);null!=d&&(e.type=6,e.ob=d);null!=h&&(e.type=7,e.Db=h);this.ba.m[a]=e};C.prototype.ta=function(a,c){var b=this.ba.m[a];null==b&&(b=new M);switch(c.length){case 4:b.type=
8;null==b.ra&&(b.ra=new Float32Array(4));b.ra[0]=c[0];b.ra[1]=c[1];b.ra[2]=c[2];b.ra[3]=c[3];break;case 9:b.type=9;null==b.V&&(b.V=new Float32Array(9));b.V[0]=c[0];b.V[1]=c[1];b.V[2]=c[2];b.V[3]=c[3];b.V[4]=c[4];b.V[5]=c[5];b.V[6]=c[6];b.V[7]=c[7];b.V[8]=c[8];break;case 16:b.type=10;null==b.H&&(b.H=new Float32Array(16));b.H[0]=c[0];b.H[1]=c[1];b.H[2]=c[2];b.H[3]=c[3];b.H[4]=c[4];b.H[5]=c[5];b.H[6]=c[6];b.H[7]=c[7];b.H[8]=c[8];b.H[9]=c[9];b.H[10]=c[10];b.H[11]=c[11];b.H[12]=c[12];b.H[13]=c[13];b.H[14]=
c[14];b.H[15]=c[15];break;default:throw Error("invalid matrix array length: "+c.length);}this.ba.m[a]=b};C.prototype.O=function(a,c){var b=this.ba.m[a];null==b&&(b=new M);b.type=11;b.zb=c;this.ba.m[a]=b};C.B=!0;M.B=!0;x.prototype.C=function(a,c,b){this.width=a;this.height=c;this.type=b;var d=a-1;d|=d>>1;d|=d>>2;d|=d>>4;d|=d>>8;a==(d|d>>16)+1?(d=c-1,d|=d>>1,d|=d>>2,d|=d>>4,d|=d>>8,d=c!=(d|d>>16)+1):d=!0;this.s=d;this.ha=1/a;this.ia=1/c;this.g.bindTexture(3553,this.aa);this.g.texImage2D(3553,0,6408,
a,c,0,6408,b,null);this.g.bindTexture(3553,null);this.h=a=this.h;this.g.bindTexture(3553,this.aa);switch(a){case 9728:this.g.texParameteri(3553,10240,9728);this.g.texParameteri(3553,10241,9728);break;case 9729:this.g.texParameteri(3553,10240,9729),this.g.texParameteri(3553,10241,9729)}this.g.bindTexture(3553,null);a=this.j;c=this.o;if(this.s&&(33071!=a||33071!=c))throw H.j("cannot use texture wrapping in NPOT textures");this.j=a;this.o=c;this.g.bindTexture(3553,this.aa);this.g.texParameteri(3553,
10242,a);this.g.texParameteri(3553,10243,c);this.g.bindTexture(3553,null);this.L()};x.prototype.L=function(){this.g.bindRenderbuffer(36161,this.F);this.g.renderbufferStorage(36161,33189,this.width,this.height);this.g.bindRenderbuffer(36161,null);this.g.bindFramebuffer(36160,this.J);this.g.framebufferRenderbuffer(36160,36096,36161,this.F);this.g.framebufferTexture2D(36160,36064,3553,this.aa,0);this.g.bindFramebuffer(36160,null)};x.B=!0;q.B=!0;m.j=function(a){return-1==m.o.indexOf(a)?null:a};p.prototype.o=
function(a,c,b,d){function h(n){n.cancelable&&n.preventDefault();n=n.changedTouches;for(var r=0,v=n.length;r<v;){var z=n[r++],B=e.h(z.identifier);if(null!=B){var G=(z.clientX-c.getBoundingClientRect().left)*(a.width/a.clientWidth);z=z.clientY-c.getBoundingClientRect().top;var F=a.height/a.clientHeight;B.da=G;B.ea=z*F;B.Ka=!1}}}this.j.U(a,c,this,b,d);var e=this.touches;c.addEventListener("touchstart",function(n){n.cancelable&&n.preventDefault();n=n.changedTouches;for(var r=0,v=n.length;r<v;){var z=
n[r++],B=e.h(z.identifier,!0),G=(z.clientX-c.getBoundingClientRect().left)*(a.width/a.clientWidth);z=z.clientY-c.getBoundingClientRect().top;var F=a.height/a.clientHeight;B.da=G;B.ea=z*F;B.Ka=!0;B.gb=!0}},{passive:!1});c.addEventListener("touchmove",function(n){n.cancelable&&n.preventDefault();n=n.changedTouches;for(var r=0,v=n.length;r<v;){var z=n[r++],B=e.h(z.identifier);if(null!=B){var G=(z.clientX-c.getBoundingClientRect().left)*(a.width/a.clientWidth);z=z.clientY-c.getBoundingClientRect().top;
var F=a.height/a.clientHeight;B.da=G;B.ea=z*F}}},{passive:!1});c.addEventListener("touchend",h);c.addEventListener("touchcancel",h);if(null!=this.h){var f=this.h;b=window.document.documentElement;b.addEventListener("keydown",function(n){var r=m.j(n.code);null!=r&&(!m.h.includes(r)&&n.cancelable&&n.preventDefault(),Object.prototype.hasOwnProperty.call(f.keys.m,r)||(f.keys.m[r]=new D),f.h.add(n.key))});b.addEventListener("keyup",function(n){var r=m.j(n.code);null!=r&&(!m.h.includes(r)&&n.cancelable&&
n.preventDefault(),Object.prototype.hasOwnProperty.call(f.keys.m,r)||(f.keys.m[r]=new D),f.keys.m[r].release(),f.s.add(n.key))});window.addEventListener("blur",function(){for(var n=f.keys.m,r=Object.keys(n),v=r.length,z=0;z<v;)n[r[z++]].release()})}};p.prototype.update=function(){this.j.update();for(var a=this.touches,c=0;c<a.touches.length;){var b=a.touches[c];b.wb||b.hb||b.Ka?(b.update(),++c):ya.h(a.touches,b)}if(null!=this.h){a=this.h;c=a.keys.m;b=Object.keys(c);for(var d=b.length,h=0;h<d;)c[b[h++]].update();
a.o.clear();a.j.clear();c=a.h.values();for(b=c.next();!b.done;)d=b.value,b=c.next(),a.o.add(d);c=a.j.values();for(b=c.next();!b.done;)d=b.value,b=c.next(),a.j.add(d);a.h.clear();a.s.clear()}};p.B=!0;var ka=pa["pot.input.InputTarget"]={lb:!0,Ea:null,jb:{wa:"Canvas",na:0,pa:"pot.input.InputTarget",toString:la},Document:{wa:"Document",na:1,pa:"pot.input.InputTarget",toString:la},Bb:{wa:"None",na:2,pa:"pot.input.InputTarget",toString:la}};ka.Ea=[ka.jb,ka.Document,ka.Bb];D.prototype.release=function(){};
D.prototype.update=function(){};D.B=!0;A.B=!0;w.prototype.U=function(a,c,b,d,h){var e=this;c.addEventListener("mouseenter",function(){return e.h=!0});c.addEventListener("mouseleave",function(){return e.h=!1});c.addEventListener("mousedown",function(f){e.j=!0;e.h=!0;f.cancelable&&f.preventDefault();switch(f.button){case 0:e.o=!0;e.F=!0;break;case 1:e.J=!0;e.X=!0;break;case 2:e.L=!0,e.ca=!0}var n=f.clientX-a.getBoundingClientRect().left;switch(b.sa){case 0:var r=a.width/d.fa/a.clientWidth;break;case 1:r=
a.width/a.clientWidth}e.da=n*r;f=f.clientY-a.getBoundingClientRect().top;switch(b.sa){case 0:var v=a.height/d.fa/a.clientHeight;break;case 1:v=a.height/a.clientHeight}return e.ea=f*v});c.addEventListener("mouseup",function(f){e.j=!0;e.h=!0;f.cancelable&&f.preventDefault();switch(f.button){case 0:e.o=!1;break;case 1:e.J=!1;break;case 2:e.L=!1}var n=f.clientX-a.getBoundingClientRect().left;switch(b.sa){case 0:var r=a.width/d.fa/a.clientWidth;break;case 1:r=a.width/a.clientWidth}e.da=n*r;f=f.clientY-
a.getBoundingClientRect().top;switch(b.sa){case 0:var v=a.height/d.fa/a.clientHeight;break;case 1:v=a.height/a.clientHeight}return e.ea=f*v});c.addEventListener("mousemove",function(f){e.j=!0;e.h=!0;var n=f.clientX-a.getBoundingClientRect().left;switch(b.sa){case 0:var r=a.width/d.fa/a.clientWidth;break;case 1:r=a.width/a.clientWidth}e.da=n*r;f=f.clientY-a.getBoundingClientRect().top;switch(b.sa){case 0:var v=a.height/d.fa/a.clientHeight;break;case 1:v=a.height/a.clientHeight}return e.ea=f*v});h&&
c.addEventListener("wheel",function(f){switch(f.deltaMode){case 0:var n=1;break;case 1:n=24;break;case 2:n=720;break;default:throw H.j("invalid wheel delta mode");}e.s+=f.deltaX*n;e.C+=f.deltaY*n;f.preventDefault()},{passive:!1});c.addEventListener("contextmenu",function(f){e.j=!0;e.h=!0;f.preventDefault()});c.addEventListener("pointerdown",function(f){c.setPointerCapture(f.pointerId)});c.addEventListener("pointerup",function(f){c.releasePointerCapture(f.pointerId)})};w.prototype.update=function(){this.x=
this.da;this.y=this.ea;this.left=this.o||this.F;this.ca=this.X=this.F=!1;this.C=this.s=0};w.B=!0;t.prototype.update=function(){this.x=this.da;this.y=this.ea;this.wb=this.hb;this.hb=this.Ka||this.gb;this.gb=!1};t.B=!0;l.prototype.h=function(a,c){null==c&&(c=!1);for(var b=0,d=this.touches;b<d.length;){var h=d[b];++b;if(h.xb==a)return h}return c?this.j(a):null};l.prototype.j=function(a){for(var c=0;;){for(var b=c,d=0,h=this.touches;d<h.length;)h[d++].id==c&&++c;if(b==c)break}b=new t;b.xb=a;b.id=c;this.touches.push(b);
return b};l.B=!0;k.prototype.start=function(){this.C||(this.j=Date.now()-this.h,this.C=!0,window.setTimeout(na(this,this.s),0))};k.prototype.F=function(a){this.h=1E3/a};k.prototype.s=function(){if(this.C){if(this.o){var a=this.update;if(k.h)try{a()}catch(d){a=H.h(d),window.alert(u.h(a))}else a();a=this.oa;if(k.h)try{a()}catch(d){a=H.h(d),window.alert(u.h(a))}else a()}else{a=Date.now();for(var c=!1;a-this.j>.5*this.h;){c=this.update;if(k.h)try{c()}catch(d){c=H.h(d),window.alert(u.h(c))}else c();c=
!0;this.j+=this.h;var b=Date.now();if(b-a>.5*this.h){this.j<b-this.h&&(this.j=b-this.h);break}}if(c)if(a=this.oa,k.h)try{a()}catch(d){a=H.h(d),window.alert(u.h(a))}else a()}window.requestAnimationFrame(na(this,this.s))}};k.B=!0;g.ib|=0;String.B=!0;Array.B=!0;y.h=128;m.h="F1 F2 F3 F4 F5 F6 F7 F8 F9 F10 F11 F12".split(" ");m.o="Escape Digit0 Digit1 Digit2 Digit3 Digit4 Digit5 Digit6 Digit7 Digit8 Digit9 Minus Equal Backspace Tab KeyQ KeyW KeyE KeyR KeyT KeyY KeyU KeyI KeyO KeyP BracketLeft BracketRight Enter ControlLeft KeyA KeyS KeyD KeyF KeyG KeyH KeyJ KeyK KeyL Semicolon Quote Backquote ShiftLeft Backslash KeyZ KeyX KeyC KeyV KeyB KeyN KeyM Comma Period Slash ShiftRight NumpadMultiply AltLeft Space CapsLock F1 F2 F3 F4 F5 F6 F7 F8 F9 F10 Numpad7 Numpad8 Numpad9 NumpadSubtract Numpad4 Numpad5 Numpad6 NumpadAdd Numpad1 Numpad2 Numpad3 Numpad0 NumpadDecimal IntlBackslash F11 F12 IntlYen NumpadEnter ControlRight NumpadDivide PrintScreen AltRight NumLock Home ArrowUp PageUp ArrowLeft ArrowRight End ArrowDown PageDown Insert Delete ContextMenu".split(" ");
k.h=!1;y.j()})("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this);
